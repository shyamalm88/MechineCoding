# News Feed - Facebook/Twitter (HLD)

## Table of Contents
1. [Problem Statement & Requirements](#1-problem-statement--requirements)
2. [High-Level Architecture](#2-high-level-architecture)
3. [Component Architecture](#3-component-architecture)
4. [Data Flow](#4-data-flow)
5. [API Design & Communication Protocols](#5-api-design--communication-protocols)
6. [Database Design](#6-database-design)
7. [Caching Strategy](#7-caching-strategy)
8. [State Management](#8-state-management)
9. [Performance Optimization](#9-performance-optimization)
10. [Error Handling & Edge Cases](#10-error-handling--edge-cases)
11. [Interview Cross-Questions](#11-interview-cross-questions)
12. [Accessibility (A11y)](#12-accessibility-a11y)
13. [Security & Content Moderation](#13-security--content-moderation)
14. [Mobile & Touch Considerations](#14-mobile--touch-considerations)
15. [Comprehensive Testing Strategy](#15-comprehensive-testing-strategy)
16. [Offline Support & PWA](#16-offline-support--pwa)
17. [Stories & Reels Deep Dive](#17-stories--reels-deep-dive)
18. [Internationalization (i18n)](#18-internationalization-i18n)
19. [Analytics & Observability](#19-analytics--observability)
20. [Notification System](#20-notification-system)
21. [Ads Integration](#21-ads-integration)

---

## 1. Problem Statement & Requirements

### Functional Requirements
- Display personalized feed of posts from friends/following
- Create posts (text, images, videos, links)
- Like, comment, share posts
- Infinite scroll with real-time updates
- Stories/Reels section
- Notifications for interactions
- New post indicator without refresh
- Pull-to-refresh for latest content

### Non-Functional Requirements
- **Latency**: Feed load < 1s (P95)
- **Freshness**: New posts appear within 10 seconds
- **Availability**: 99.99% uptime
- **Scalability**: Handle 1B+ users, 100B+ posts
- **Personalization**: Ranked feed based on engagement

### Capacity Estimation
```
Daily Active Users: 500 million
Posts created per day: 500 million
Feed requests per day: 10 billion
Average followers per user: 200
Average feed size: 50 posts
Avg post size: 1 KB (metadata) + media
Read:Write ratio: 100:1
```

---

## 2. High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              CLIENT LAYER                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚   Web App       â”‚  â”‚   iOS App       â”‚  â”‚  Android App    â”‚             â”‚
â”‚  â”‚   (React)       â”‚  â”‚                 â”‚  â”‚                 â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚           â”‚                    â”‚                    â”‚                       â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                         â”‚ HTTPS â”‚ WebSocket                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚       â”‚
                          â–¼       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           EDGE LAYER                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         CDN (Static + API Edge Cache)                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         Load Balancer + API Gateway                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                          â–¼                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Feed          â”‚      â”‚   Post          â”‚      â”‚   Notification  â”‚
â”‚   Service       â”‚      â”‚   Service       â”‚      â”‚   Service       â”‚
â”‚                 â”‚      â”‚                 â”‚      â”‚                 â”‚
â”‚ â€¢ Feed gen      â”‚      â”‚ â€¢ CRUD posts    â”‚      â”‚ â€¢ Push          â”‚
â”‚ â€¢ Ranking       â”‚      â”‚ â€¢ Media upload  â”‚      â”‚ â€¢ In-app        â”‚
â”‚ â€¢ Personalize   â”‚      â”‚ â€¢ Like/Comment  â”‚      â”‚ â€¢ Email         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                        â”‚                        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           FEED GENERATION LAYER                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚   Fan-out       â”‚  â”‚   Ranking       â”‚  â”‚   ML Model      â”‚             â”‚
â”‚  â”‚   Service       â”‚  â”‚   Service       â”‚  â”‚   Service       â”‚             â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚             â”‚
â”‚  â”‚ â€¢ Push on write â”‚  â”‚ â€¢ Engagement    â”‚  â”‚ â€¢ Predict CTR   â”‚             â”‚
â”‚  â”‚ â€¢ Pull on read  â”‚  â”‚   scoring       â”‚  â”‚ â€¢ Personalize   â”‚             â”‚
â”‚  â”‚ â€¢ Hybrid        â”‚  â”‚ â€¢ Recency       â”‚  â”‚                 â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           DATA LAYER                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚   Cassandra     â”‚  â”‚     Redis       â”‚  â”‚   PostgreSQL    â”‚             â”‚
â”‚  â”‚   (Posts, Feed) â”‚  â”‚   (Cache)       â”‚  â”‚   (Users)       â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚   Kafka         â”‚  â”‚   S3/Blob       â”‚  â”‚   Elasticsearch â”‚             â”‚
â”‚  â”‚   (Events)      â”‚  â”‚   (Media)       â”‚  â”‚   (Search)      â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Feed Generation Strategies

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FEED GENERATION STRATEGIES                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  PUSH MODEL (Fan-out on Write)                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                               â”‚
â”‚                                                                              â”‚
â”‚   User A posts                                                              â”‚
â”‚        â”‚                                                                     â”‚
â”‚        â–¼                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  For each follower of A:                                              â”‚  â”‚
â”‚   â”‚    INSERT INTO feed_{follower_id} (post_id, timestamp)               â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚                                                                     â”‚
â”‚        â”œâ”€â”€â”€â”€â”€â”€â”€> Follower B's feed cache                                   â”‚
â”‚        â”œâ”€â”€â”€â”€â”€â”€â”€> Follower C's feed cache                                   â”‚
â”‚        â”œâ”€â”€â”€â”€â”€â”€â”€> Follower D's feed cache                                   â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€> ... (all 1000 followers)                                  â”‚
â”‚                                                                              â”‚
â”‚   Pros:                                                                     â”‚
â”‚   â€¢ Fast read (feed is pre-computed)                                       â”‚
â”‚   â€¢ Simple query: SELECT * FROM feed_{user_id}                            â”‚
â”‚                                                                              â”‚
â”‚   Cons:                                                                     â”‚
â”‚   â€¢ Slow write for celebrities (millions of followers)                     â”‚
â”‚   â€¢ Storage overhead (duplicate post_id in many feeds)                     â”‚
â”‚   â€¢ Stale if user preferences change                                       â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  PULL MODEL (Fan-in on Read)                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                 â”‚
â”‚                                                                              â”‚
â”‚   User B requests feed                                                      â”‚
â”‚        â”‚                                                                     â”‚
â”‚        â–¼                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  1. Get list of users B follows                                       â”‚  â”‚
â”‚   â”‚  2. For each followed user:                                           â”‚  â”‚
â”‚   â”‚       SELECT recent posts FROM posts WHERE author = followed_user    â”‚  â”‚
â”‚   â”‚  3. Merge, rank, return top 50                                        â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚   Pros:                                                                     â”‚
â”‚   â€¢ Fast write (just store post)                                           â”‚
â”‚   â€¢ No storage duplication                                                 â”‚
â”‚   â€¢ Always fresh                                                            â”‚
â”‚                                                                              â”‚
â”‚   Cons:                                                                     â”‚
â”‚   â€¢ Slow read (aggregate at request time)                                  â”‚
â”‚   â€¢ High compute for power users (follows many)                           â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  HYBRID MODEL (Recommended) âœ…                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚  Regular users (< 10K followers):                                    â”‚  â”‚
â”‚   â”‚    â†’ PUSH: Fan-out to all followers on write                        â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚  Celebrities (> 10K followers):                                      â”‚  â”‚
â”‚   â”‚    â†’ PULL: Fetch their posts on read                                â”‚  â”‚
â”‚   â”‚    â†’ Pre-compute for most active followers                          â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚  On Feed Request:                                                    â”‚  â”‚
â”‚   â”‚    1. Get pre-computed feed (from push)                             â”‚  â”‚
â”‚   â”‚    2. Merge with celebrity posts (pull)                             â”‚  â”‚
â”‚   â”‚    3. Rank and return                                                â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Component Architecture

### Frontend Component Hierarchy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              FeedApp                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                            Header                                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚   Logo    â”‚  â”‚  SearchBar   â”‚  â”‚ Notificationsâ”‚  â”‚  UserMenu   â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     ğŸ””       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚               â”‚                                       â”‚               â”‚  â”‚
â”‚  â”‚   Sidebar     â”‚              MainFeed                â”‚   RightPanel  â”‚  â”‚
â”‚  â”‚               â”‚                                       â”‚               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ NavItem â”‚  â”‚  â”‚ Stories (Horizontal Scroll)  â”‚   â”‚  â”‚ Trendingâ”‚  â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ  Home â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”      â”‚   â”‚  â”‚ Topics  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ‘¤ Prof â”‚  â”‚  â”‚ â”‚Storyâ”‚ â”‚Storyâ”‚ â”‚Storyâ”‚ ... â”‚   â”‚  â”‚         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ”” Notifâ”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜      â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ’¬ Msgs â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚               â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚               â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚ Who to  â”‚  â”‚  â”‚
â”‚  â”‚               â”‚  â”‚ CreatePostBox                 â”‚   â”‚  â”‚ Follow  â”‚  â”‚  â”‚
â”‚  â”‚               â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚  â”‚         â”‚  â”‚  â”‚
â”‚  â”‚               â”‚  â”‚ â”‚What's on your mind?        â”‚â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚               â”‚  â”‚ â”‚ ğŸ“·  ğŸ¥  ğŸ“  ğŸ˜Š  ...        â”‚â”‚   â”‚               â”‚  â”‚
â”‚  â”‚               â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚               â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚ Sponsoredâ”‚  â”‚  â”‚
â”‚  â”‚               â”‚                                       â”‚  â”‚          â”‚  â”‚  â”‚
â”‚  â”‚               â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚               â”‚  â”‚ NewPostsIndicator             â”‚   â”‚               â”‚  â”‚
â”‚  â”‚               â”‚  â”‚ "3 new posts - Click to see"  â”‚   â”‚               â”‚  â”‚
â”‚  â”‚               â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚               â”‚  â”‚
â”‚  â”‚               â”‚                                       â”‚               â”‚  â”‚
â”‚  â”‚               â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚               â”‚  â”‚
â”‚  â”‚               â”‚  â”‚ FeedList (Virtualized)        â”‚   â”‚               â”‚  â”‚
â”‚  â”‚               â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚               â”‚  â”‚
â”‚  â”‚               â”‚  â”‚ â”‚ PostCard                    â”‚â”‚   â”‚               â”‚  â”‚
â”‚  â”‚               â”‚  â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚   â”‚               â”‚  â”‚
â”‚  â”‚               â”‚  â”‚ â”‚ â”‚ Avatar â”‚ Name â”‚ Time    â”‚ â”‚â”‚   â”‚               â”‚  â”‚
â”‚  â”‚               â”‚  â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚   â”‚               â”‚  â”‚
â”‚  â”‚               â”‚  â”‚ â”‚ Content (Text/Image/Video)  â”‚â”‚   â”‚               â”‚  â”‚
â”‚  â”‚               â”‚  â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚   â”‚               â”‚  â”‚
â”‚  â”‚               â”‚  â”‚ â”‚ â”‚ ğŸ‘ Like â”‚ ğŸ’¬ Comment â”‚ â†—ï¸â”‚â”‚ â”‚â”‚   â”‚               â”‚  â”‚
â”‚  â”‚               â”‚  â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚   â”‚               â”‚  â”‚
â”‚  â”‚               â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚               â”‚  â”‚
â”‚  â”‚               â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚               â”‚  â”‚
â”‚  â”‚               â”‚  â”‚ â”‚ PostCard ...                â”‚â”‚   â”‚               â”‚  â”‚
â”‚  â”‚               â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚               â”‚  â”‚
â”‚  â”‚               â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚               â”‚  â”‚
â”‚  â”‚               â”‚  â”‚ â”‚ InfiniteScrollTrigger       â”‚â”‚   â”‚               â”‚  â”‚
â”‚  â”‚               â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚               â”‚  â”‚
â”‚  â”‚               â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚               â”‚  â”‚
â”‚  â”‚               â”‚                                       â”‚               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Key Component Responsibilities

| Component | Responsibility |
|-----------|---------------|
| `FeedList` | Virtualized list, infinite scroll, optimistic updates |
| `PostCard` | Display post content, media, engagement actions |
| `CreatePostBox` | Post composer, media upload, preview |
| `Stories` | Horizontal carousel, auto-advance, view tracking |
| `NewPostsIndicator` | Show count of new posts, click to load |
| `CommentSection` | Nested comments, lazy load, reply functionality |

---

## 4. Data Flow

### Post Creation Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User A  â”‚     â”‚    UI    â”‚     â”‚   API    â”‚     â”‚  Fanout  â”‚     â”‚Followers â”‚
â”‚          â”‚     â”‚          â”‚     â”‚  Service â”‚     â”‚  Service â”‚     â”‚          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                â”‚                â”‚                â”‚                â”‚
     â”‚ 1. Create post â”‚                â”‚                â”‚                â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚ 2. Optimistic  â”‚                â”‚                â”‚
     â”‚                â”‚    add to feed â”‚                â”‚                â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚                â”‚                â”‚
     â”‚ (see own post) â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚ 3. POST /posts â”‚                â”‚                â”‚
     â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚ 4. Store post  â”‚                â”‚
     â”‚                â”‚                â”‚    in Cassandraâ”‚                â”‚
     â”‚                â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚ 5. Publish to  â”‚                â”‚
     â”‚                â”‚                â”‚    Kafka       â”‚                â”‚
     â”‚                â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚                â”‚
     â”‚                â”‚   (post_id)    â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚ 6. For each    â”‚
     â”‚                â”‚                â”‚                â”‚    follower:   â”‚
     â”‚                â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚ If regular:    â”‚
     â”‚                â”‚                â”‚                â”‚ â””> Add to feed â”‚
     â”‚                â”‚                â”‚                â”‚    cache       â”‚
     â”‚                â”‚                â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚ 7. Notify via  â”‚
     â”‚                â”‚                â”‚                â”‚    WebSocket   â”‚
     â”‚                â”‚                â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                â”‚                â”‚                â”‚   "New posts"  â”‚
     â”‚                â”‚                â”‚                â”‚                â”‚
```

### Feed Fetch Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FEED FETCH FLOW                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   User requests feed                                                        â”‚
â”‚        â”‚                                                                     â”‚
â”‚        â–¼                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  1. Check Redis cache for pre-computed feed                          â”‚  â”‚
â”‚   â”‚     Key: feed:{user_id}                                              â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚                                                                     â”‚
â”‚        â”œâ”€â”€â”€â”€ Cache HIT â”€â”€â”€â”€> Return cached feed                            â”‚
â”‚        â”‚                                                                     â”‚
â”‚        â””â”€â”€â”€â”€ Cache MISS â”€â”€â”€>                                                â”‚
â”‚                    â”‚                                                         â”‚
â”‚                    â–¼                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  2. Fetch from feed table (pre-computed via fan-out)                 â”‚  â”‚
â”‚   â”‚     SELECT post_ids FROM user_feeds WHERE user_id = ?                â”‚  â”‚
â”‚   â”‚     LIMIT 100                                                        â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚                                                                     â”‚
â”‚        â–¼                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  3. Fetch celebrity posts (pull model)                               â”‚  â”‚
â”‚   â”‚     For each celebrity user follows:                                 â”‚  â”‚
â”‚   â”‚       SELECT recent posts WHERE author = celebrity                   â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚                                                                     â”‚
â”‚        â–¼                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  4. Merge and rank                                                   â”‚  â”‚
â”‚   â”‚     â€¢ Combine push + pull posts                                      â”‚  â”‚
â”‚   â”‚     â€¢ Apply ranking algorithm                                        â”‚  â”‚
â”‚   â”‚     â€¢ Filter seen posts                                              â”‚  â”‚
â”‚   â”‚     â€¢ Return top 50                                                  â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚                                                                     â”‚
â”‚        â–¼                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  5. Hydrate post data                                                â”‚  â”‚
â”‚   â”‚     â€¢ Fetch full post content                                        â”‚  â”‚
â”‚   â”‚     â€¢ Fetch author details                                           â”‚  â”‚
â”‚   â”‚     â€¢ Fetch engagement counts                                        â”‚  â”‚
â”‚   â”‚     â€¢ Batch fetch from cache/DB                                      â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚                                                                     â”‚
â”‚        â–¼                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  6. Cache result in Redis                                            â”‚  â”‚
â”‚   â”‚     SET feed:{user_id} {serialized_feed}                             â”‚  â”‚
â”‚   â”‚     EX 60 (1 minute TTL)                                             â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚                                                                     â”‚
â”‚        â–¼                                                                     â”‚
â”‚   Return feed to client                                                     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ranking Algorithm

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FEED RANKING ALGORITHM                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Score = Affinity Ã— PostWeight Ã— TimeDecay Ã— TypeBoost                     â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  1. AFFINITY (How close is user to author?)                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚
â”‚  â€¢ Interaction frequency (likes, comments on their posts)                  â”‚
â”‚  â€¢ Profile views                                                            â”‚
â”‚  â€¢ Message history                                                          â”‚
â”‚  â€¢ Mutual friends                                                           â”‚
â”‚                                                                              â”‚
â”‚  Score: 0.1 (acquaintance) â†’ 1.0 (close friend)                           â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  2. POST WEIGHT (How engaging is this post?)                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                â”‚
â”‚  â€¢ Like count (log scale)                                                  â”‚
â”‚  â€¢ Comment count (weighted higher)                                         â”‚
â”‚  â€¢ Share count (weighted highest)                                          â”‚
â”‚  â€¢ Click-through rate                                                      â”‚
â”‚  â€¢ Time spent viewing                                                      â”‚
â”‚                                                                              â”‚
â”‚  Score: log(likes + 2*comments + 5*shares + 1)                            â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  3. TIME DECAY (How old is the post?)                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                       â”‚
â”‚  â€¢ Exponential decay over time                                             â”‚
â”‚  â€¢ Faster decay for time-sensitive content                                 â”‚
â”‚  â€¢ Slower decay for evergreen content                                      â”‚
â”‚                                                                              â”‚
â”‚  Score: e^(-Î» Ã— hours_since_posted)                                        â”‚
â”‚  Î» = 0.1 for evergreen, 0.5 for news                                      â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  4. TYPE BOOST (Content type preferences)                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                   â”‚
â”‚  â€¢ User engagement history by type                                         â”‚
â”‚  â€¢ Video: 1.5x if user watches videos                                     â”‚
â”‚  â€¢ Images: 1.2x default                                                    â”‚
â”‚  â€¢ Text: 1.0x default                                                      â”‚
â”‚  â€¢ Links: 0.8x (lower engagement typically)                               â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  Implementation:                                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  def rank_posts(user_id, posts):                                     â”‚   â”‚
â”‚  â”‚      affinity_scores = get_affinity(user_id, [p.author for p])      â”‚   â”‚
â”‚  â”‚      user_preferences = get_preferences(user_id)                     â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚      for post in posts:                                              â”‚   â”‚
â”‚  â”‚          post.score = (                                              â”‚   â”‚
â”‚  â”‚              affinity_scores[post.author] *                         â”‚   â”‚
â”‚  â”‚              calc_post_weight(post) *                                â”‚   â”‚
â”‚  â”‚              calc_time_decay(post.created_at) *                     â”‚   â”‚
â”‚  â”‚              user_preferences[post.type]                            â”‚   â”‚
â”‚  â”‚          )                                                           â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚      return sorted(posts, key=lambda p: p.score, reverse=True)      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. API Design & Communication Protocols

### Protocol Comparison

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PROTOCOL COMPARISON FOR FEED                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    Protocol     â”‚     Pros      â”‚     Cons      â”‚     Use Case              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 â”‚ â€¢ Cacheable   â”‚ â€¢ No real-timeâ”‚ â€¢ âœ… Initial feed load    â”‚
â”‚    REST         â”‚ â€¢ Simple      â”‚   push        â”‚ â€¢ âœ… Infinite scroll      â”‚
â”‚                 â”‚ â€¢ Stateless   â”‚               â”‚ â€¢ âœ… Post CRUD            â”‚
â”‚                 â”‚               â”‚               â”‚ â€¢ âœ… Like/Comment         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 â”‚ â€¢ Nested data â”‚ â€¢ Complex     â”‚ â€¢ Post with comments      â”‚
â”‚   GraphQL       â”‚ â€¢ No over-    â”‚   caching     â”‚ â€¢ Profile with posts      â”‚
â”‚                 â”‚   fetching    â”‚               â”‚ â€¢ Mobile (bandwidth)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 â”‚ â€¢ Real-time   â”‚ â€¢ Connection  â”‚ â€¢ âœ… New post notif       â”‚
â”‚   WebSocket     â”‚ â€¢ Bi-direct   â”‚   overhead    â”‚ â€¢ âœ… Typing indicator     â”‚
â”‚                 â”‚               â”‚               â”‚ â€¢ Live comments           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 â”‚ â€¢ Server push â”‚ â€¢ One-way     â”‚ â€¢ âœ… "X new posts" badge  â”‚
â”‚    SSE          â”‚ â€¢ Simple      â”‚               â”‚ â€¢ Live engagement counts  â”‚
â”‚                 â”‚ â€¢ Auto-recon  â”‚               â”‚ â€¢ Lightweight notif       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 â”‚ â€¢ Simple      â”‚ â€¢ Latency     â”‚ â€¢ Fallback for WS         â”‚
â”‚  Long Polling   â”‚ â€¢ Works thru  â”‚ â€¢ Reconnect   â”‚ â€¢ Corporate firewalls     â”‚
â”‚                 â”‚   firewalls   â”‚   overhead    â”‚                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Hybrid Approach for Feed

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  RECOMMENDED HYBRID APPROACH                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   REST for:                                                                 â”‚
â”‚   â€¢ GET /feed (initial load, pagination)                                   â”‚
â”‚   â€¢ POST /posts (create)                                                    â”‚
â”‚   â€¢ POST /posts/:id/like                                                    â”‚
â”‚   â€¢ POST /posts/:id/comments                                                â”‚
â”‚   â€¢ GET /posts/:id (detail view)                                           â”‚
â”‚                                                                              â”‚
â”‚   SSE or WebSocket for:                                                     â”‚
â”‚   â€¢ New post notifications ("3 new posts")                                 â”‚
â”‚   â€¢ Real-time engagement updates (likes, comments)                         â”‚
â”‚   â€¢ Typing indicators (comments)                                           â”‚
â”‚                                                                              â”‚
â”‚   Why SSE might be better than WebSocket for feed:                         â”‚
â”‚   â€¢ Feed is mostly read (server â†’ client)                                  â”‚
â”‚   â€¢ Simpler than WebSocket                                                  â”‚
â”‚   â€¢ Auto-reconnection built-in                                             â”‚
â”‚   â€¢ Works better with HTTP/2                                               â”‚
â”‚                                                                              â”‚
â”‚   When to use WebSocket instead:                                           â”‚
â”‚   â€¢ If you also have chat (share connection)                               â”‚
â”‚   â€¢ Need bidirectional for live comments                                   â”‚
â”‚   â€¢ Real-time collaborative features                                       â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### REST API Endpoints

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           REST API DESIGN                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  FEED                                                                       â”‚
â”‚  â”€â”€â”€â”€                                                                        â”‚
â”‚  GET /api/v1/feed                                                           â”‚
â”‚      ?cursor=xxx&limit=20&refresh=true                                     â”‚
â”‚      â†’ Returns:                                                             â”‚
â”‚        {                                                                     â”‚
â”‚          "posts": [...],                                                    â”‚
â”‚          "pagination": { "next_cursor": "...", "has_more": true },         â”‚
â”‚          "new_posts_count": 3  // for badge                                â”‚
â”‚        }                                                                     â”‚
â”‚                                                                              â”‚
â”‚  GET /api/v1/feed/new                                                       â”‚
â”‚      ?since=timestamp                                                       â”‚
â”‚      â†’ Returns only new posts since last fetch                             â”‚
â”‚                                                                              â”‚
â”‚  POSTS                                                                      â”‚
â”‚  â”€â”€â”€â”€â”€                                                                       â”‚
â”‚  POST /api/v1/posts                                                         â”‚
â”‚      Body: { content, media_ids[], audience }                              â”‚
â”‚      â†’ Returns: { post_id, ... }                                           â”‚
â”‚                                                                              â”‚
â”‚  GET /api/v1/posts/:id                                                      â”‚
â”‚      â†’ Returns: Full post with comments preview                            â”‚
â”‚                                                                              â”‚
â”‚  DELETE /api/v1/posts/:id                                                   â”‚
â”‚                                                                              â”‚
â”‚  ENGAGEMENT                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                  â”‚
â”‚  POST /api/v1/posts/:id/reactions                                           â”‚
â”‚      Body: { type: "like" | "love" | "haha" | ... }                       â”‚
â”‚                                                                              â”‚
â”‚  DELETE /api/v1/posts/:id/reactions                                         â”‚
â”‚                                                                              â”‚
â”‚  GET /api/v1/posts/:id/comments                                             â”‚
â”‚      ?cursor=xxx&limit=20                                                  â”‚
â”‚                                                                              â”‚
â”‚  POST /api/v1/posts/:id/comments                                            â”‚
â”‚      Body: { content, reply_to? }                                          â”‚
â”‚                                                                              â”‚
â”‚  POST /api/v1/posts/:id/share                                               â”‚
â”‚      Body: { content?, audience }                                          â”‚
â”‚                                                                              â”‚
â”‚  MEDIA                                                                      â”‚
â”‚  â”€â”€â”€â”€â”€                                                                       â”‚
â”‚  POST /api/v1/media/upload                                                  â”‚
â”‚      â†’ Returns: { media_id, upload_url } (presigned S3)                    â”‚
â”‚                                                                              â”‚
â”‚  POST /api/v1/media/:id/confirm                                             â”‚
â”‚      â†’ Confirms upload complete, triggers processing                       â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SSE/WebSocket Events

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      REAL-TIME EVENT SCHEMA                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  SSE Connection:                                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                             â”‚
â”‚  EventSource('/api/v1/feed/stream?token=JWT')                              â”‚
â”‚                                                                              â”‚
â”‚  Events:                                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€                                                                    â”‚
â”‚                                                                              â”‚
â”‚  // New posts available                                                     â”‚
â”‚  event: new_posts                                                           â”‚
â”‚  data: { "count": 3, "preview": [{ "author": "...", "content": "..." }] } â”‚
â”‚                                                                              â”‚
â”‚  // Engagement update on visible post                                      â”‚
â”‚  event: engagement                                                          â”‚
â”‚  data: {                                                                    â”‚
â”‚    "post_id": "...",                                                       â”‚
â”‚    "likes": 150,                                                            â”‚
â”‚    "comments": 25,                                                          â”‚
â”‚    "shares": 5                                                              â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  // New comment on post you're viewing                                     â”‚
â”‚  event: comment                                                             â”‚
â”‚  data: {                                                                    â”‚
â”‚    "post_id": "...",                                                       â”‚
â”‚    "comment": { "id": "...", "author": {...}, "content": "..." }          â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  // Notification                                                            â”‚
â”‚  event: notification                                                        â”‚
â”‚  data: {                                                                    â”‚
â”‚    "type": "like",                                                         â”‚
â”‚    "actor": { "name": "...", "avatar": "..." },                            â”‚
â”‚    "post_id": "..."                                                        â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Database Design

### SQL vs NoSQL Decision

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATABASE CHOICE RATIONALE                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     Cassandra (Posts & Feed)                         â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  USE FOR:                                                            â”‚   â”‚
â”‚  â”‚  â€¢ Posts (write-heavy, time-series)                                 â”‚   â”‚
â”‚  â”‚  â€¢ User feed (pre-computed, partitioned by user)                   â”‚   â”‚
â”‚  â”‚  â€¢ Comments (nested, by post)                                       â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  WHY Cassandra:                                                      â”‚   â”‚
â”‚  â”‚  â€¢ 500M posts/day needs horizontal write scaling                   â”‚   â”‚
â”‚  â”‚  â€¢ Time-based partitioning (posts by date)                         â”‚   â”‚
â”‚  â”‚  â€¢ Feed partitioned by user_id                                     â”‚   â”‚
â”‚  â”‚  â€¢ Tunable consistency (ONE for speed)                             â”‚   â”‚
â”‚  â”‚  â€¢ No single point of failure                                      â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  Why NOT PostgreSQL for posts:                                      â”‚   â”‚
â”‚  â”‚  â€¢ Can't scale writes horizontally                                 â”‚   â”‚
â”‚  â”‚  â€¢ 500M writes/day would overwhelm single master                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     PostgreSQL (Relational Data)                     â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  USE FOR:                                                            â”‚   â”‚
â”‚  â”‚  â€¢ Users (authentication, profiles)                                 â”‚   â”‚
â”‚  â”‚  â€¢ Friendships/Follows (graph relationships)                       â”‚   â”‚
â”‚  â”‚  â€¢ Settings, preferences                                            â”‚   â”‚
â”‚  â”‚  â€¢ Groups, pages                                                    â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  WHY SQL:                                                            â”‚   â”‚
â”‚  â”‚  â€¢ ACID for user data                                               â”‚   â”‚
â”‚  â”‚  â€¢ Complex queries (mutual friends)                                 â”‚   â”‚
â”‚  â”‚  â€¢ Lower write volume (user updates rare)                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     Redis (Cache + Real-time)                        â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  USE FOR:                                                            â”‚   â”‚
â”‚  â”‚  â€¢ Feed cache (pre-computed feeds)                                  â”‚   â”‚
â”‚  â”‚  â€¢ Post cache (frequently accessed)                                 â”‚   â”‚
â”‚  â”‚  â€¢ Engagement counts                                                 â”‚   â”‚
â”‚  â”‚  â€¢ Session storage                                                   â”‚   â”‚
â”‚  â”‚  â€¢ Rate limiting                                                     â”‚   â”‚
â”‚  â”‚  â€¢ Pub/Sub for real-time                                            â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  Data Structures:                                                    â”‚   â”‚
â”‚  â”‚  â€¢ ZSET: feed:{user_id} (post_id scored by rank)                   â”‚   â”‚
â”‚  â”‚  â€¢ HASH: post:{id} (post content)                                   â”‚   â”‚
â”‚  â”‚  â€¢ STRING: post:{id}:likes (counter)                                â”‚   â”‚
â”‚  â”‚  â€¢ SET: post:{id}:liked_by (user_ids)                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     Kafka (Event Streaming)                          â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  USE FOR:                                                            â”‚   â”‚
â”‚  â”‚  â€¢ Fan-out events (new post â†’ notify followers)                    â”‚   â”‚
â”‚  â”‚  â€¢ Activity events (likes, comments, shares)                       â”‚   â”‚
â”‚  â”‚  â€¢ Analytics events                                                  â”‚   â”‚
â”‚  â”‚  â€¢ Async processing pipeline                                        â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  Topics:                                                             â”‚   â”‚
â”‚  â”‚  â€¢ posts.created                                                     â”‚   â”‚
â”‚  â”‚  â€¢ posts.engagement                                                  â”‚   â”‚
â”‚  â”‚  â€¢ notifications                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Cassandra Schema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CASSANDRA SCHEMA                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Table: posts                                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                â”‚
â”‚  CREATE TABLE posts (                                                       â”‚
â”‚    post_id       TIMEUUID,                                                  â”‚
â”‚    author_id     UUID,                                                      â”‚
â”‚    content       TEXT,                                                      â”‚
â”‚    media_urls    LIST<TEXT>,                                               â”‚
â”‚    post_type     TEXT,         -- text, image, video, link                â”‚
â”‚    audience      TEXT,         -- public, friends, private                 â”‚
â”‚    created_at    TIMESTAMP,                                                 â”‚
â”‚    like_count    COUNTER,      -- Cassandra counter column                â”‚
â”‚    comment_count COUNTER,                                                   â”‚
â”‚    share_count   COUNTER,                                                   â”‚
â”‚    PRIMARY KEY ((author_id), post_id)                                      â”‚
â”‚  ) WITH CLUSTERING ORDER BY (post_id DESC);                                â”‚
â”‚                                                                              â”‚
â”‚  Query: Get user's posts                                                   â”‚
â”‚  SELECT * FROM posts WHERE author_id = ? ORDER BY post_id DESC            â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  Table: user_feed                                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                           â”‚
â”‚  CREATE TABLE user_feed (                                                   â”‚
â”‚    user_id       UUID,                                                      â”‚
â”‚    post_id       TIMEUUID,                                                  â”‚
â”‚    author_id     UUID,                                                      â”‚
â”‚    score         DOUBLE,        -- Ranking score at insertion time        â”‚
â”‚    created_at    TIMESTAMP,                                                 â”‚
â”‚    PRIMARY KEY ((user_id), score, post_id)                                 â”‚
â”‚  ) WITH CLUSTERING ORDER BY (score DESC, post_id DESC);                    â”‚
â”‚                                                                              â”‚
â”‚  Query: Get user's feed (ranked)                                           â”‚
â”‚  SELECT * FROM user_feed WHERE user_id = ? LIMIT 50                       â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  Table: post_by_id (for hydration)                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                           â”‚
â”‚  CREATE TABLE post_by_id (                                                  â”‚
â”‚    post_id       TIMEUUID,                                                  â”‚
â”‚    author_id     UUID,                                                      â”‚
â”‚    content       TEXT,                                                      â”‚
â”‚    media_urls    LIST<TEXT>,                                               â”‚
â”‚    created_at    TIMESTAMP,                                                 â”‚
â”‚    PRIMARY KEY (post_id)                                                   â”‚
â”‚  );                                                                          â”‚
â”‚                                                                              â”‚
â”‚  Query: Batch fetch posts by IDs                                           â”‚
â”‚  SELECT * FROM post_by_id WHERE post_id IN (?, ?, ?, ...)                 â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  Table: comments                                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                            â”‚
â”‚  CREATE TABLE comments (                                                    â”‚
â”‚    post_id       TIMEUUID,                                                  â”‚
â”‚    comment_id    TIMEUUID,                                                  â”‚
â”‚    author_id     UUID,                                                      â”‚
â”‚    content       TEXT,                                                      â”‚
â”‚    reply_to      TIMEUUID,     -- for nested replies                       â”‚
â”‚    created_at    TIMESTAMP,                                                 â”‚
â”‚    PRIMARY KEY ((post_id), comment_id)                                     â”‚
â”‚  ) WITH CLUSTERING ORDER BY (comment_id DESC);                             â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. Caching Strategy

### Multi-Layer Cache

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CACHING ARCHITECTURE                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  LAYER 1: CDN Cache                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â€¢ Static assets (JS, CSS, images)                                  â”‚   â”‚
â”‚  â”‚  â€¢ User profile images                                               â”‚   â”‚
â”‚  â”‚  â€¢ Post media (images, video thumbnails)                            â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  NOT cached at CDN:                                                  â”‚   â”‚
â”‚  â”‚  â€¢ Feed responses (personalized)                                    â”‚   â”‚
â”‚  â”‚  â€¢ Engagement counts (change frequently)                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  LAYER 2: Redis (Application Cache)                                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Feed Cache:                                                         â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                        â”‚   â”‚
â”‚  â”‚  Key: feed:{user_id}                                                â”‚   â”‚
â”‚  â”‚  Type: ZSET (post_id scored by ranking)                             â”‚   â”‚
â”‚  â”‚  TTL: 60 seconds                                                     â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  Why ZSET:                                                           â”‚   â”‚
â”‚  â”‚  â€¢ Ordered by score (ranking)                                       â”‚   â”‚
â”‚  â”‚  â€¢ Easy to add new posts at correct position                        â”‚   â”‚
â”‚  â”‚  â€¢ Range queries for pagination                                     â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  Post Cache:                                                         â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                         â”‚   â”‚
â”‚  â”‚  Key: post:{id}                                                     â”‚   â”‚
â”‚  â”‚  Type: HASH                                                          â”‚   â”‚
â”‚  â”‚  TTL: 5 minutes                                                      â”‚   â”‚
â”‚  â”‚  Fields: content, author_id, created_at, media_urls                 â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  Engagement Cache (write-through):                                  â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚   â”‚
â”‚  â”‚  Key: post:{id}:stats                                               â”‚   â”‚
â”‚  â”‚  Type: HASH                                                          â”‚   â”‚
â”‚  â”‚  Fields: likes, comments, shares                                    â”‚   â”‚
â”‚  â”‚  TTL: None (always accurate via write-through)                      â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  User Has Liked:                                                    â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                     â”‚   â”‚
â”‚  â”‚  Key: post:{id}:liked_by                                            â”‚   â”‚
â”‚  â”‚  Type: SET (user_ids who liked)                                     â”‚   â”‚
â”‚  â”‚  TTL: 1 hour                                                         â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  Check: SISMEMBER post:{id}:liked_by {user_id}                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  LAYER 3: Client Cache (React Query)                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â€¢ Feed posts (staleTime: 30s)                                      â”‚   â”‚
â”‚  â”‚  â€¢ User profiles                                                     â”‚   â”‚
â”‚  â”‚  â€¢ Comments (staleTime: 1 min)                                      â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  Optimistic updates:                                                â”‚   â”‚
â”‚  â”‚  â€¢ Immediately reflect likes, comments                              â”‚   â”‚
â”‚  â”‚  â€¢ Rollback on error                                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Feed Invalidation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FEED CACHE INVALIDATION                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   Strategy: Short TTL + Real-time Supplement                               â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                 â”‚
â”‚                                                                              â”‚
â”‚   1. Feed cache TTL: 60 seconds                                            â”‚
â”‚      â€¢ Short enough to stay fresh                                          â”‚
â”‚      â€¢ Long enough to absorb read spikes                                   â”‚
â”‚                                                                              â”‚
â”‚   2. New posts: Don't invalidate, use "New posts" badge                    â”‚
â”‚      â€¢ User clicks badge â†’ Prepend new posts                              â”‚
â”‚      â€¢ Avoids constant cache invalidation                                  â”‚
â”‚                                                                              â”‚
â”‚   3. On refresh/scroll: Re-fetch, merge with client cache                 â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚   When to Invalidate Feed Cache:                                           â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                             â”‚
â”‚   â€¢ User unfollows someone â†’ DEL feed:{user_id}                           â”‚
â”‚   â€¢ User follows someone â†’ DEL feed:{user_id}                             â”‚
â”‚   â€¢ User blocks someone â†’ DEL feed:{user_id}                              â”‚
â”‚   â€¢ Post deleted â†’ DEL feed:{user_id} for all affected                    â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚   Engagement Count Updates:                                                â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                  â”‚
â”‚   â€¢ Write-through: Update cache AND DB together                           â”‚
â”‚   â€¢ Use Redis INCR for atomic counter updates                             â”‚
â”‚   â€¢ Propagate to clients via SSE                                          â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. State Management

### State Categories

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       STATE MANAGEMENT STRATEGY                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  SERVER STATE (React Query / SWR)                                   â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                   â”‚   â”‚
â”‚  â”‚  â€¢ Feed posts (paginated)                                           â”‚   â”‚
â”‚  â”‚  â€¢ Post details                                                      â”‚   â”‚
â”‚  â”‚  â€¢ Comments                                                          â”‚   â”‚
â”‚  â”‚  â€¢ User profiles                                                     â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  Key configuration:                                                  â”‚   â”‚
â”‚  â”‚  â€¢ staleTime: 30-60 seconds (short for freshness)                  â”‚   â”‚
â”‚  â”‚  â€¢ cacheTime: 5 minutes                                             â”‚   â”‚
â”‚  â”‚  â€¢ refetchOnWindowFocus: true                                       â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  Infinite query for feed:                                           â”‚   â”‚
â”‚  â”‚  useInfiniteQuery(['feed'], fetchFeed, { getNextPageParam })       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  REAL-TIME STATE (Zustand / Context)                                â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                 â”‚   â”‚
â”‚  â”‚  â€¢ New posts count (badge)                                          â”‚   â”‚
â”‚  â”‚  â€¢ New posts buffer (awaiting user action)                          â”‚   â”‚
â”‚  â”‚  â€¢ Engagement updates (optimistic)                                  â”‚   â”‚
â”‚  â”‚  â€¢ Notification count                                               â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  Updated via SSE/WebSocket events                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  UI STATE (Local useState)                                          â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                           â”‚   â”‚
â”‚  â”‚  â€¢ Create post modal open                                           â”‚   â”‚
â”‚  â”‚  â€¢ Comment input focused                                            â”‚   â”‚
â”‚  â”‚  â€¢ Emoji picker open                                                â”‚   â”‚
â”‚  â”‚  â€¢ Media upload progress                                            â”‚   â”‚
â”‚  â”‚  â€¢ Scroll position                                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  OPTIMISTIC STATE (React Query Mutation)                            â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                             â”‚   â”‚
â”‚  â”‚  â€¢ New post (appears immediately)                                   â”‚   â”‚
â”‚  â”‚  â€¢ Likes (toggle immediately, rollback on error)                   â”‚   â”‚
â”‚  â”‚  â€¢ Comments (appear immediately)                                    â”‚   â”‚
â”‚  â”‚  â€¢ Delete post (hide immediately)                                   â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  Pattern:                                                            â”‚   â”‚
â”‚  â”‚  â€¢ onMutate: Update cache optimistically                           â”‚   â”‚
â”‚  â”‚  â€¢ onError: Rollback to previous state                             â”‚   â”‚
â”‚  â”‚  â€¢ onSettled: Refetch to ensure consistency                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. Performance Optimization

### Feed List Virtualization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FEED VIRTUALIZATION                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Problem: 100+ posts with media â†’ DOM overload, memory issues              â”‚
â”‚                                                                              â”‚
â”‚  Solution: Virtual scrolling + Media management                            â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Virtualization (react-window / virtuoso):                          â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                           â”‚   â”‚
â”‚  â”‚  â€¢ Only render visible posts + buffer (3 above, 3 below)           â”‚   â”‚
â”‚  â”‚  â€¢ Variable height support (text vs media posts)                   â”‚   â”‚
â”‚  â”‚  â€¢ Measure on render, cache heights                                 â”‚   â”‚
â”‚  â”‚  â€¢ Scroll restoration on navigation                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Media Optimization:                                                 â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                 â”‚   â”‚
â”‚  â”‚  â€¢ Lazy load images (Intersection Observer)                        â”‚   â”‚
â”‚  â”‚  â€¢ Blur-up placeholder (LQIP)                                       â”‚   â”‚
â”‚  â”‚  â€¢ Pause videos when not in view                                    â”‚   â”‚
â”‚  â”‚  â€¢ Unload media when scrolled far away                             â”‚   â”‚
â”‚  â”‚  â€¢ srcset for responsive images                                     â”‚   â”‚
â”‚  â”‚  â€¢ WebP with JPEG fallback                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Video Handling:                                                     â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                      â”‚   â”‚
â”‚  â”‚  â€¢ Poster image until in view                                       â”‚   â”‚
â”‚  â”‚  â€¢ Autoplay muted when visible                                      â”‚   â”‚
â”‚  â”‚  â€¢ Pause when scrolled away                                         â”‚   â”‚
â”‚  â”‚  â€¢ Preload: none (until visible)                                   â”‚   â”‚
â”‚  â”‚  â€¢ Limit concurrent video loads (max 2)                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Optimistic Updates Pattern

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OPTIMISTIC UPDATES                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Like Button Example:                                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                       â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  const likeMutation = useMutation({                                  â”‚   â”‚
â”‚  â”‚    mutationFn: (postId) => api.likePost(postId),                    â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚    onMutate: async (postId) => {                                    â”‚   â”‚
â”‚  â”‚      // Cancel outgoing refetches                                   â”‚   â”‚
â”‚  â”‚      await queryClient.cancelQueries(['feed']);                     â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚      // Snapshot previous value                                     â”‚   â”‚
â”‚  â”‚      const previousFeed = queryClient.getQueryData(['feed']);       â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚      // Optimistically update                                        â”‚   â”‚
â”‚  â”‚      queryClient.setQueryData(['feed'], (old) => ({                 â”‚   â”‚
â”‚  â”‚        ...old,                                                       â”‚   â”‚
â”‚  â”‚        posts: old.posts.map(post =>                                 â”‚   â”‚
â”‚  â”‚          post.id === postId                                         â”‚   â”‚
â”‚  â”‚            ? { ...post, liked: true, likes: post.likes + 1 }        â”‚   â”‚
â”‚  â”‚            : post                                                    â”‚   â”‚
â”‚  â”‚        )                                                             â”‚   â”‚
â”‚  â”‚      }));                                                            â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚      return { previousFeed };                                       â”‚   â”‚
â”‚  â”‚    },                                                                â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚    onError: (err, postId, context) => {                             â”‚   â”‚
â”‚  â”‚      // Rollback on error                                           â”‚   â”‚
â”‚  â”‚      queryClient.setQueryData(['feed'], context.previousFeed);      â”‚   â”‚
â”‚  â”‚    },                                                                â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚    onSettled: () => {                                               â”‚   â”‚
â”‚  â”‚      // Refetch to ensure consistency                               â”‚   â”‚
â”‚  â”‚      queryClient.invalidateQueries(['feed']);                       â”‚   â”‚
â”‚  â”‚    }                                                                 â”‚   â”‚
â”‚  â”‚  });                                                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 10. Error Handling & Edge Cases

### Edge Cases

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           EDGE CASES                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  1. Empty Feed                                                              â”‚
â”‚     â€¢ New user with no follows                                             â”‚
â”‚     â€¢ Show suggestions: "Who to follow", "Trending", "Popular"            â”‚
â”‚                                                                              â”‚
â”‚  2. Stale Feed After App Background                                        â”‚
â”‚     â€¢ Detect app resume                                                     â”‚
â”‚     â€¢ Fetch new posts count                                                â”‚
â”‚     â€¢ Show "X new posts" banner                                            â”‚
â”‚                                                                              â”‚
â”‚  3. Duplicate Posts (Fan-out race conditions)                              â”‚
â”‚     â€¢ Deduplicate by post_id on client                                     â”‚
â”‚     â€¢ Use Set for post_ids                                                 â”‚
â”‚                                                                              â”‚
â”‚  4. Post Deleted While Viewing                                              â”‚
â”‚     â€¢ Real-time notification via SSE                                       â”‚
â”‚     â€¢ Gracefully remove from feed                                          â”‚
â”‚     â€¢ Show "This post was deleted" if on detail page                       â”‚
â”‚                                                                              â”‚
â”‚  5. Celebrity Post Spike                                                    â”‚
â”‚     â€¢ Rate limit fan-out                                                    â”‚
â”‚     â€¢ Queue processing for non-active followers                            â”‚
â”‚     â€¢ Prioritize active users                                              â”‚
â”‚                                                                              â”‚
â”‚  6. Infinite Scroll Edge Cases                                              â”‚
â”‚     â€¢ No more posts: Show "You're all caught up!"                         â”‚
â”‚     â€¢ Error loading more: Show retry button                                â”‚
â”‚     â€¢ Maintain scroll position on refresh                                  â”‚
â”‚                                                                              â”‚
â”‚  7. Media Upload Failures                                                   â”‚
â”‚     â€¢ Resumable uploads (tus protocol)                                     â”‚
â”‚     â€¢ Show retry option                                                     â”‚
â”‚     â€¢ Save draft with pending media                                        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 11. Interview Cross-Questions

### Common Questions & Answers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INTERVIEW CROSS-QUESTIONS                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Q: Why hybrid push/pull for feed generation?                              â”‚
â”‚  A: â€¢ Pure push: Slow for celebrities (1M followers = 1M writes)          â”‚
â”‚     â€¢ Pure pull: Slow read (aggregate 500 followings)                      â”‚
â”‚     â€¢ Hybrid: Fast for 99% users, pull only for celebrities               â”‚
â”‚     â€¢ Trade-off: Storage vs compute                                        â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  Q: Why Cassandra for posts, not PostgreSQL?                               â”‚
â”‚  A: â€¢ 500M posts/day needs horizontal write scaling                        â”‚
â”‚     â€¢ Cassandra scales linearly with nodes                                 â”‚
â”‚     â€¢ Time-based partitioning natural fit                                  â”‚
â”‚     â€¢ PostgreSQL: Can't scale writes (single master)                      â”‚
â”‚     â€¢ Trade-off: No joins, eventual consistency                           â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  Q: How do you keep feed fresh without constant polling?                   â”‚
â”‚  A: â€¢ Short cache TTL (60s) + SSE for new posts badge                     â”‚
â”‚     â€¢ User clicks "X new posts" to load                                   â”‚
â”‚     â€¢ Pull-to-refresh for manual update                                   â”‚
â”‚     â€¢ Background refresh on app resume                                    â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  Q: How does the ranking algorithm work?                                   â”‚
â”‚  A: â€¢ Score = Affinity Ã— PostWeight Ã— TimeDecay Ã— TypeBoost               â”‚
â”‚     â€¢ Affinity: How close is user to author (interactions)                â”‚
â”‚     â€¢ PostWeight: Engagement metrics (log scale)                          â”‚
â”‚     â€¢ TimeDecay: Exponential decay over hours                             â”‚
â”‚     â€¢ TypeBoost: User's content type preferences                          â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  Q: How do you handle real-time engagement updates?                        â”‚
â”‚  A: â€¢ Redis counters (INCR for likes)                                     â”‚
â”‚     â€¢ Write-through: Update cache AND DB                                  â”‚
â”‚     â€¢ SSE/WebSocket to push to viewers                                    â”‚
â”‚     â€¢ Batch updates for high-engagement posts                             â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  Q: What metrics would you track?                                          â”‚
â”‚  A: â€¢ Feed load time (P50, P95)                                           â”‚
â”‚     â€¢ Time to first post visible                                          â”‚
â”‚     â€¢ Scroll depth (engagement)                                            â”‚
â”‚     â€¢ Like/comment latency                                                 â”‚
â”‚     â€¢ Cache hit ratio                                                       â”‚
â”‚     â€¢ Fan-out queue depth                                                  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 12. Accessibility (A11y)

### Feed Accessibility Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ACCESSIBLE FEED INTERFACE                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  ARIA Structure for Feed:                                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                    â”‚
â”‚                                                                              â”‚
â”‚  <main role="main" aria-label="News Feed">                                 â”‚
â”‚                                                                              â”‚
â”‚    <!-- Live region for new posts -->                                      â”‚
â”‚    <div aria-live="polite" aria-atomic="false" class="sr-only">           â”‚
â”‚      <!-- "3 new posts available" -->                                      â”‚
â”‚    </div>                                                                   â”‚
â”‚                                                                              â”‚
â”‚    <!-- New posts banner -->                                               â”‚
â”‚    <button aria-label="View 3 new posts">                                  â”‚
â”‚      3 new posts                                                            â”‚
â”‚    </button>                                                                â”‚
â”‚                                                                              â”‚
â”‚    <!-- Feed list -->                                                      â”‚
â”‚    <div role="feed" aria-busy="false" aria-label="Posts">                 â”‚
â”‚                                                                              â”‚
â”‚      <article role="article"                                               â”‚
â”‚               aria-posinset="1"                                            â”‚
â”‚               aria-setsize="-1"                                            â”‚
â”‚               aria-labelledby="post-1-author"                              â”‚
â”‚               aria-describedby="post-1-content post-1-stats"               â”‚
â”‚               tabindex="0">                                                 â”‚
â”‚                                                                              â”‚
â”‚        <header>                                                             â”‚
â”‚          <span id="post-1-author">John Doe</span>                          â”‚
â”‚          <time datetime="2024-12-22T10:30:00Z">2 hours ago</time>         â”‚
â”‚        </header>                                                            â”‚
â”‚                                                                              â”‚
â”‚        <div id="post-1-content">Post text content...</div>                â”‚
â”‚                                                                              â”‚
â”‚        <img src="..." alt="Sunset over mountains with orange sky">        â”‚
â”‚                                                                              â”‚
â”‚        <footer id="post-1-stats">                                          â”‚
â”‚          <span>142 likes</span>                                            â”‚
â”‚          <span>23 comments</span>                                          â”‚
â”‚        </footer>                                                            â”‚
â”‚                                                                              â”‚
â”‚      </article>                                                             â”‚
â”‚                                                                              â”‚
â”‚    </div>                                                                   â”‚
â”‚  </main>                                                                    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Accessible Post Component

```jsx
// components/AccessiblePost.jsx
const AccessiblePost = ({ post, index, onLike, onComment, onShare }) => {
  const postRef = useRef(null);
  const { announce } = useAriaLive();

  const handleLike = async () => {
    const newLiked = !post.liked;
    await onLike(post.id);
    announce(newLiked ? 'Post liked' : 'Post unliked');
  };

  const formatRelativeTime = (timestamp) => {
    const rtf = new Intl.RelativeTimeFormat('en', { numeric: 'auto' });
    const diff = Date.now() - new Date(timestamp);
    const hours = Math.floor(diff / 3600000);
    if (hours < 1) return 'just now';
    if (hours < 24) return rtf.format(-hours, 'hour');
    return rtf.format(-Math.floor(hours / 24), 'day');
  };

  return (
    <article
      ref={postRef}
      role="article"
      aria-posinset={index + 1}
      aria-setsize={-1} // Unknown total (infinite scroll)
      aria-labelledby={`post-${post.id}-author`}
      aria-describedby={`post-${post.id}-content post-${post.id}-engagement`}
      tabIndex={0}
      className="post"
    >
      {/* Author Header */}
      <header className="post__header">
        <img
          src={post.author.avatar}
          alt="" // Decorative, name is in text
          aria-hidden="true"
        />
        <div>
          <span id={`post-${post.id}-author`}>
            {post.author.name}
          </span>
          <time
            dateTime={post.createdAt}
            aria-label={`Posted ${formatRelativeTime(post.createdAt)}`}
          >
            {formatRelativeTime(post.createdAt)}
          </time>
        </div>
      </header>

      {/* Content */}
      <div id={`post-${post.id}-content`} className="post__content">
        <p>{post.text}</p>

        {post.media?.map((media, i) => (
          media.type === 'image' ? (
            <img
              key={i}
              src={media.url}
              alt={media.altText || 'Image shared in post'}
              loading="lazy"
            />
          ) : (
            <video
              key={i}
              src={media.url}
              aria-label={media.altText || 'Video shared in post'}
              controls
            >
              {media.captions && (
                <track kind="captions" src={media.captions} />
              )}
            </video>
          )
        ))}
      </div>

      {/* Engagement Stats */}
      <div
        id={`post-${post.id}-engagement`}
        className="post__stats"
        aria-label={`${post.likeCount} likes, ${post.commentCount} comments, ${post.shareCount} shares`}
      >
        <span aria-hidden="true">{formatCount(post.likeCount)} likes</span>
        <span aria-hidden="true">{formatCount(post.commentCount)} comments</span>
      </div>

      {/* Action Buttons */}
      <div className="post__actions" role="group" aria-label="Post actions">
        <button
          onClick={handleLike}
          aria-pressed={post.liked}
          aria-label={post.liked ? 'Unlike this post' : 'Like this post'}
        >
          <HeartIcon filled={post.liked} aria-hidden="true" />
          <span>Like</span>
        </button>

        <button
          onClick={() => onComment(post.id)}
          aria-label={`Comment on this post. ${post.commentCount} existing comments`}
        >
          <CommentIcon aria-hidden="true" />
          <span>Comment</span>
        </button>

        <button
          onClick={() => onShare(post.id)}
          aria-label="Share this post"
          aria-haspopup="menu"
        >
          <ShareIcon aria-hidden="true" />
          <span>Share</span>
        </button>
      </div>
    </article>
  );
};
```

### Keyboard Navigation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      KEYBOARD NAVIGATION MAP                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Feed Navigation:                                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                            â”‚
â”‚  J / â†“             â†’ Next post                                              â”‚
â”‚  K / â†‘             â†’ Previous post                                          â”‚
â”‚  Home              â†’ First post                                             â”‚
â”‚  End               â†’ Load more / Last loaded post                           â”‚
â”‚  Page Down         â†’ Skip 5 posts                                           â”‚
â”‚  Page Up           â†’ Back 5 posts                                           â”‚
â”‚                                                                              â”‚
â”‚  Post Actions (when post is focused):                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                        â”‚
â”‚  L                 â†’ Like/Unlike post                                       â”‚
â”‚  C                 â†’ Open comment box                                       â”‚
â”‚  S                 â†’ Open share menu                                        â”‚
â”‚  O / Enter         â†’ Open post detail view                                  â”‚
â”‚  B                 â†’ Bookmark/Save post                                     â”‚
â”‚  R                 â†’ Report post                                            â”‚
â”‚  H                 â†’ Hide post                                              â”‚
â”‚  M                 â†’ Mute author                                            â”‚
â”‚                                                                              â”‚
â”‚  Comment Section (when open):                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                â”‚
â”‚  Tab               â†’ Move between comments                                  â”‚
â”‚  Enter (on input)  â†’ Submit comment                                        â”‚
â”‚  Escape            â†’ Close comment section                                  â”‚
â”‚  L (on comment)    â†’ Like comment                                           â”‚
â”‚  R (on comment)    â†’ Reply to comment                                       â”‚
â”‚                                                                              â”‚
â”‚  Create Post:                                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                â”‚
â”‚  N                 â†’ Open new post composer                                 â”‚
â”‚  Ctrl/Cmd + Enter  â†’ Submit post                                            â”‚
â”‚  Escape            â†’ Close composer (with confirmation if content)         â”‚
â”‚                                                                              â”‚
â”‚  Global:                                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€                                                                     â”‚
â”‚  /                 â†’ Focus search                                           â”‚
â”‚  G then H          â†’ Go to Home                                             â”‚
â”‚  G then N          â†’ Go to Notifications                                    â”‚
â”‚  G then M          â†’ Go to Messages                                         â”‚
â”‚  ?                 â†’ Show keyboard shortcuts                                â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Infinite Scroll Accessibility

```jsx
// hooks/useAccessibleInfiniteScroll.js
const useAccessibleInfiniteScroll = ({
  onLoadMore,
  hasMore,
  isLoading,
  itemCount
}) => {
  const loadMoreRef = useRef(null);
  const { announce } = useAriaLive();
  const previousCount = useRef(itemCount);

  // Announce when new posts are loaded
  useEffect(() => {
    if (itemCount > previousCount.current) {
      const newCount = itemCount - previousCount.current;
      announce(`${newCount} more posts loaded. ${itemCount} total posts.`);
    }
    previousCount.current = itemCount;
  }, [itemCount, announce]);

  // Intersection Observer for auto-load
  useEffect(() => {
    if (!hasMore || isLoading) return;

    const observer = new IntersectionObserver(
      ([entry]) => {
        if (entry.isIntersecting) {
          announce('Loading more posts...');
          onLoadMore();
        }
      },
      { rootMargin: '200px' }
    );

    if (loadMoreRef.current) {
      observer.observe(loadMoreRef.current);
    }

    return () => observer.disconnect();
  }, [hasMore, isLoading, onLoadMore, announce]);

  // Manual load for keyboard users
  const handleManualLoad = () => {
    announce('Loading more posts...');
    onLoadMore();
  };

  return {
    loadMoreRef,
    LoadMoreComponent: () => (
      <div ref={loadMoreRef} className="load-more">
        {isLoading ? (
          <div role="status" aria-live="polite">
            <Spinner aria-hidden="true" />
            <span className="sr-only">Loading more posts...</span>
          </div>
        ) : hasMore ? (
          <button
            onClick={handleManualLoad}
            aria-label="Load more posts"
          >
            Load More
          </button>
        ) : (
          <p role="status">You've reached the end of your feed</p>
        )}
      </div>
    )
  };
};
```

---

## 13. Security & Content Moderation

### Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SECURITY LAYERS FOR FEED                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  1. INPUT VALIDATION (Frontend + Backend)                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                   â”‚
â”‚  â€¢ Post content: Max 5000 chars, no script tags                            â”‚
â”‚  â€¢ Media: Allowed types (jpg, png, gif, mp4), max size                     â”‚
â”‚  â€¢ URLs: Validate against allowlist, check for redirects                   â”‚
â”‚  â€¢ User input: Sanitize all fields                                         â”‚
â”‚                                                                              â”‚
â”‚  2. XSS PREVENTION                                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  // âœ… Safe - React escapes by default                              â”‚   â”‚
â”‚  â”‚  <p>{post.content}</p>                                               â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  // âŒ NEVER do this with user content                               â”‚   â”‚
â”‚  â”‚  <div dangerouslySetInnerHTML={{ __html: post.content }} />         â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  // âœ… If HTML is needed (rich text), use DOMPurify                  â”‚   â”‚
â”‚  â”‚  import DOMPurify from 'dompurify';                                 â”‚   â”‚
â”‚  â”‚  const clean = DOMPurify.sanitize(post.content, {                   â”‚   â”‚
â”‚  â”‚    ALLOWED_TAGS: ['b', 'i', 'a', 'br'],                             â”‚   â”‚
â”‚  â”‚    ALLOWED_ATTR: ['href']                                           â”‚   â”‚
â”‚  â”‚  });                                                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  3. CSP HEADERS                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                               â”‚
â”‚  Content-Security-Policy:                                                   â”‚
â”‚    default-src 'self';                                                      â”‚
â”‚    script-src 'self';                                                       â”‚
â”‚    style-src 'self' 'unsafe-inline';                                       â”‚
â”‚    img-src 'self' https://media.feed.app https://pbs.twimg.com blob:;     â”‚
â”‚    media-src 'self' https://video.feed.app blob:;                          â”‚
â”‚    connect-src 'self' wss://realtime.feed.app;                             â”‚
â”‚    frame-ancestors 'none';                                                  â”‚
â”‚                                                                              â”‚
â”‚  4. RATE LIMITING                                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                               â”‚
â”‚  â€¢ Posts: 50 per hour per user                                             â”‚
â”‚  â€¢ Likes: 200 per hour per user                                            â”‚
â”‚  â€¢ Comments: 100 per hour per user                                         â”‚
â”‚  â€¢ API calls: 1000 per minute per user                                     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Content Moderation Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CONTENT MODERATION FLOW                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   Post Created                                                              â”‚
â”‚        â”‚                                                                     â”‚
â”‚        â–¼                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  Stage 1: Automated Pre-screening (< 100ms)                          â”‚  â”‚
â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                            â”‚  â”‚
â”‚   â”‚  â€¢ Regex for known bad words/phrases                                 â”‚  â”‚
â”‚   â”‚  â€¢ Hash matching for known bad images (PhotoDNA)                    â”‚  â”‚
â”‚   â”‚  â€¢ URL blocklist check                                               â”‚  â”‚
â”‚   â”‚  â€¢ Spam pattern detection                                            â”‚  â”‚
â”‚   â”‚  â”‚                                                                   â”‚  â”‚
â”‚   â”‚  â”œâ”€â”€â”€ CLEAR â”€â”€â”€> Publish immediately                                â”‚  â”‚
â”‚   â”‚  â”‚                                                                   â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€ FLAGGED â”€â”€â”€> Stage 2                                          â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚                                                                     â”‚
â”‚        â–¼                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  Stage 2: ML Classification (< 500ms)                                â”‚  â”‚
â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                â”‚  â”‚
â”‚   â”‚  â€¢ Toxicity score (hate speech, harassment)                         â”‚  â”‚
â”‚   â”‚  â€¢ NSFW detection for images/videos                                  â”‚  â”‚
â”‚   â”‚  â€¢ Violence detection                                                â”‚  â”‚
â”‚   â”‚  â€¢ Spam probability                                                  â”‚  â”‚
â”‚   â”‚  â”‚                                                                   â”‚  â”‚
â”‚   â”‚  â”œâ”€â”€â”€ SCORE < 0.3 â”€â”€â”€> Publish                                      â”‚  â”‚
â”‚   â”‚  â”‚                                                                   â”‚  â”‚
â”‚   â”‚  â”œâ”€â”€â”€ 0.3 < SCORE < 0.7 â”€â”€â”€> Publish with warning + queue review   â”‚  â”‚
â”‚   â”‚  â”‚                                                                   â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€ SCORE > 0.7 â”€â”€â”€> Hold for human review                        â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚                                                                     â”‚
â”‚        â–¼                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  Stage 3: Human Review (for flagged content)                         â”‚  â”‚
â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                             â”‚  â”‚
â”‚   â”‚  â€¢ Review queue prioritized by severity                             â”‚  â”‚
â”‚   â”‚  â€¢ Multiple reviewers for borderline cases                          â”‚  â”‚
â”‚   â”‚  â€¢ Appeal process for user                                           â”‚  â”‚
â”‚   â”‚  â”‚                                                                   â”‚  â”‚
â”‚   â”‚  â”œâ”€â”€â”€ APPROVE â”€â”€â”€> Publish                                          â”‚  â”‚
â”‚   â”‚  â”‚                                                                   â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€ REJECT â”€â”€â”€> Remove + notify user + log                        â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Report & Block System

```jsx
// components/ReportModal.jsx
const REPORT_REASONS = [
  { id: 'spam', label: 'Spam', description: 'Misleading or repetitive content' },
  { id: 'harassment', label: 'Harassment', description: 'Bullying or targeted attacks' },
  { id: 'hate', label: 'Hate speech', description: 'Attacks based on identity' },
  { id: 'violence', label: 'Violence', description: 'Threats or graphic content' },
  { id: 'misinformation', label: 'Misinformation', description: 'False or misleading claims' },
  { id: 'copyright', label: 'Copyright', description: 'Unauthorized use of content' },
  { id: 'other', label: 'Other', description: 'Something else' }
];

const ReportModal = ({ post, isOpen, onClose }) => {
  const [reason, setReason] = useState(null);
  const [details, setDetails] = useState('');
  const [isSubmitting, setIsSubmitting] = useState(false);

  const handleSubmit = async () => {
    setIsSubmitting(true);
    try {
      await api.reportPost(post.id, { reason, details });
      // Show confirmation
      toast.success('Report submitted. We\'ll review this content.');
      // Offer to hide/block
      onClose({ showFollowUp: true });
    } catch (error) {
      toast.error('Failed to submit report. Please try again.');
    } finally {
      setIsSubmitting(false);
    }
  };

  return (
    <Modal isOpen={isOpen} onClose={onClose} aria-labelledby="report-title">
      <h2 id="report-title">Report this post</h2>

      <p className="report-description">
        Help us understand what's wrong with this content.
      </p>

      <fieldset>
        <legend className="sr-only">Select a reason</legend>
        {REPORT_REASONS.map(r => (
          <label key={r.id} className="report-option">
            <input
              type="radio"
              name="reason"
              value={r.id}
              checked={reason === r.id}
              onChange={() => setReason(r.id)}
            />
            <div>
              <span className="report-option__label">{r.label}</span>
              <span className="report-option__desc">{r.description}</span>
            </div>
          </label>
        ))}
      </fieldset>

      {reason && (
        <textarea
          placeholder="Add more details (optional)"
          value={details}
          onChange={(e) => setDetails(e.target.value)}
          maxLength={500}
          aria-label="Additional details"
        />
      )}

      <div className="modal-actions">
        <button onClick={onClose} disabled={isSubmitting}>
          Cancel
        </button>
        <button
          onClick={handleSubmit}
          disabled={!reason || isSubmitting}
          className="primary"
        >
          {isSubmitting ? 'Submitting...' : 'Submit Report'}
        </button>
      </div>
    </Modal>
  );
};
```

---

## 14. Mobile & Touch Considerations

### Touch Gestures

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       TOUCH GESTURE SYSTEM                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Post Interactions:                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                          â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚   DOUBLE TAP â†’ Like                                                 â”‚   â”‚
â”‚  â”‚   ğŸ‘†ğŸ‘†                                                               â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚   â”‚
â”‚  â”‚   â”‚  â¤ï¸ (heart animation appears)         â”‚                        â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚   LONG PRESS â†’ Context Menu                                         â”‚   â”‚
â”‚  â”‚   ğŸ‘†â”â”â”â”â” (500ms)                                                   â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚   â”‚
â”‚  â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚                        â”‚   â”‚
â”‚  â”‚   â”‚ â”‚ Save Post              â”‚            â”‚                        â”‚   â”‚
â”‚  â”‚   â”‚ â”‚ Copy Link              â”‚            â”‚                        â”‚   â”‚
â”‚  â”‚   â”‚ â”‚ Share to...            â”‚            â”‚                        â”‚   â”‚
â”‚  â”‚   â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚            â”‚                        â”‚   â”‚
â”‚  â”‚   â”‚ â”‚ Hide Post              â”‚            â”‚                        â”‚   â”‚
â”‚  â”‚   â”‚ â”‚ Report                 â”‚            â”‚                        â”‚   â”‚
â”‚  â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚                        â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  Feed Navigation:                                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                            â”‚
â”‚  â€¢ SWIPE DOWN (at top) â†’ Pull to refresh                                   â”‚
â”‚  â€¢ SWIPE LEFT on post â†’ Quick actions (save, hide)                         â”‚
â”‚  â€¢ PINCH on image â†’ Zoom preview                                           â”‚
â”‚                                                                              â”‚
â”‚  Video Controls:                                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                             â”‚
â”‚  â€¢ TAP â†’ Play/Pause                                                        â”‚
â”‚  â€¢ DOUBLE TAP RIGHT â†’ Skip 10 seconds                                      â”‚
â”‚  â€¢ DOUBLE TAP LEFT â†’ Rewind 10 seconds                                     â”‚
â”‚  â€¢ SWIPE UP (fullscreen) â†’ Next video (Reels mode)                         â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Pull to Refresh Implementation

```jsx
// components/PullToRefresh.jsx
import { useSpring, animated } from '@react-spring/web';
import { useDrag } from '@use-gesture/react';

const PullToRefresh = ({ onRefresh, children }) => {
  const THRESHOLD = 80;
  const MAX_PULL = 120;

  const [{ y, opacity }, api] = useSpring(() => ({ y: 0, opacity: 0 }));
  const [isRefreshing, setIsRefreshing] = useState(false);

  const bind = useDrag(({
    down,
    movement: [, my],
    velocity: [, vy],
    direction: [, dy],
    cancel,
    first
  }) => {
    // Only allow pull down when at top of scroll
    if (first && window.scrollY > 0) {
      cancel();
      return;
    }

    // Only allow downward movement
    if (my < 0) {
      api.start({ y: 0, opacity: 0 });
      return;
    }

    if (down) {
      // Rubberband effect
      const resistance = 0.4;
      const pullDistance = Math.min(my * resistance, MAX_PULL);
      api.start({
        y: pullDistance,
        opacity: Math.min(pullDistance / THRESHOLD, 1),
        immediate: true
      });
    } else {
      // Release
      if (my > THRESHOLD && !isRefreshing) {
        // Trigger refresh
        setIsRefreshing(true);
        api.start({ y: 60, opacity: 1 });

        onRefresh().finally(() => {
          setIsRefreshing(false);
          api.start({ y: 0, opacity: 0 });
        });
      } else {
        api.start({ y: 0, opacity: 0 });
      }
    }
  }, {
    axis: 'y',
    filterTaps: true,
    pointer: { touch: true }
  });

  return (
    <div {...bind()} style={{ touchAction: 'pan-y' }}>
      {/* Refresh indicator */}
      <animated.div
        className="pull-indicator"
        style={{
          transform: y.to(v => `translateY(${v - 60}px)`),
          opacity
        }}
      >
        {isRefreshing ? (
          <Spinner />
        ) : (
          <animated.div
            style={{
              transform: y.to(v => `rotate(${(v / THRESHOLD) * 180}deg)`)
            }}
          >
            <ArrowDownIcon />
          </animated.div>
        )}
      </animated.div>

      {/* Feed content */}
      <animated.div style={{ transform: y.to(v => `translateY(${v}px)`) }}>
        {children}
      </animated.div>
    </div>
  );
};
```

### Double Tap to Like

```jsx
// hooks/useDoubleTap.js
const useDoubleTap = (onDoubleTap, onSingleTap, delay = 300) => {
  const lastTap = useRef(0);
  const timeout = useRef(null);

  const handleTap = useCallback((e) => {
    const now = Date.now();
    const timeDiff = now - lastTap.current;

    if (timeDiff < delay && timeDiff > 0) {
      // Double tap
      clearTimeout(timeout.current);
      onDoubleTap?.(e);
    } else {
      // Potential single tap - wait to see if double
      timeout.current = setTimeout(() => {
        onSingleTap?.(e);
      }, delay);
    }

    lastTap.current = now;
  }, [onDoubleTap, onSingleTap, delay]);

  return handleTap;
};

// Usage in PostCard
const PostCard = ({ post, onLike }) => {
  const [showHeart, setShowHeart] = useState(false);

  const handleDoubleTap = (e) => {
    // Only like if not already liked
    if (!post.liked) {
      onLike(post.id);
    }

    // Show heart animation at tap position
    const rect = e.currentTarget.getBoundingClientRect();
    setShowHeart({
      x: e.clientX - rect.left,
      y: e.clientY - rect.top
    });

    // Haptic feedback
    if (navigator.vibrate) {
      navigator.vibrate(50);
    }

    // Hide after animation
    setTimeout(() => setShowHeart(null), 1000);
  };

  const handleTap = useDoubleTap(handleDoubleTap, null);

  return (
    <article className="post" onClick={handleTap}>
      {/* Post content */}
      <div className="post__media">
        {post.media && <img src={post.media} alt="" />}

        {/* Heart animation overlay */}
        {showHeart && (
          <div
            className="like-heart-animation"
            style={{ left: showHeart.x, top: showHeart.y }}
          >
            â¤ï¸
          </div>
        )}
      </div>
    </article>
  );
};
```

### Responsive Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RESPONSIVE BREAKPOINTS                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Mobile (< 768px):                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                                             â”‚
â”‚  â”‚ â”‚ Header (sticky)         â”‚â”‚                                             â”‚
â”‚  â”‚ â”‚ [Logo] [Search] [+]     â”‚â”‚                                             â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚                                             â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                                             â”‚
â”‚  â”‚ â”‚ Stories (horizontal)    â”‚â”‚                                             â”‚
â”‚  â”‚ â”‚ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â†’          â”‚â”‚                                             â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚                                             â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                                             â”‚
â”‚  â”‚ â”‚ Post (full width)       â”‚â”‚                                             â”‚
â”‚  â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚â”‚                                             â”‚
â”‚  â”‚ â”‚ â”‚ Image/Video       â”‚   â”‚â”‚ â† Full bleed media                         â”‚
â”‚  â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚â”‚                                             â”‚
â”‚  â”‚ â”‚ Actions: â¤ï¸ ğŸ’¬ â†—ï¸ ğŸ”–   â”‚â”‚                                             â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚                                             â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                                             â”‚
â”‚  â”‚ â”‚ Bottom Nav              â”‚â”‚                                             â”‚
â”‚  â”‚ â”‚ ğŸ  ğŸ” â• â¤ï¸ ğŸ‘¤         â”‚â”‚                                             â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚                                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
â”‚                                                                              â”‚
â”‚  Tablet (768px - 1024px):                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  [Sidebar]  â”‚  [Feed - centered, max 600px]  â”‚  [Suggestions]       â”‚   â”‚
â”‚  â”‚  Collapsed  â”‚                                 â”‚  Visible             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  Desktop (> 1024px):                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  [Sidebar]  â”‚  [Feed - centered, max 600px]  â”‚  [Right Panel]       â”‚   â”‚
â”‚  â”‚  Full       â”‚                                 â”‚  Trending, Ads       â”‚   â”‚
â”‚  â”‚  Navigation â”‚                                 â”‚  Who to Follow       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  Key Responsive Decisions:                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                   â”‚
â”‚  â€¢ Post width: Max 600px (readability)                                     â”‚
â”‚  â€¢ Media: Full bleed on mobile, contained on desktop                       â”‚
â”‚  â€¢ Navigation: Bottom nav on mobile, sidebar on desktop                    â”‚
â”‚  â€¢ Comments: Sheet from bottom on mobile, inline on desktop               â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 15. Comprehensive Testing Strategy

### Testing Pyramid

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         TESTING PYRAMID                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚                            â•±â•²                                                â”‚
â”‚                           â•±  â•²                                               â”‚
â”‚                          â•± E2Eâ•²         10-15 tests                         â”‚
â”‚                         â•±â”€â”€â”€â”€â”€â”€â•²        (Create post, like, scroll)        â”‚
â”‚                        â•±        â•²                                            â”‚
â”‚                       â•±Integrationâ•²     100-150 tests                       â”‚
â”‚                      â•±â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•²     (API, real-time, mutations)        â”‚
â”‚                     â•±              â•²                                         â”‚
â”‚                    â•±   Unit Tests   â•²   500+ tests                          â”‚
â”‚                   â•±â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•²  (Components, utils, hooks)         â”‚
â”‚                  â•±                    â•²                                      â”‚
â”‚                 â•±â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•²                                  â”‚
â”‚                                                                              â”‚
â”‚  Focus Areas:                                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                â”‚
â”‚  â€¢ Unit: Post rendering, time formatting, like toggling                    â”‚
â”‚  â€¢ Integration: Infinite scroll, optimistic updates, SSE                   â”‚
â”‚  â€¢ E2E: Full post creation flow, feed browsing, engagement                 â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Unit Tests

```jsx
// __tests__/components/PostCard.test.jsx
import { render, screen, fireEvent } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import { PostCard } from '../PostCard';

describe('PostCard', () => {
  const mockPost = {
    id: 'post-1',
    author: {
      id: 'user-1',
      name: 'John Doe',
      avatar: 'https://example.com/avatar.jpg'
    },
    content: 'Hello, world!',
    media: null,
    likeCount: 42,
    commentCount: 5,
    liked: false,
    createdAt: new Date(Date.now() - 3600000).toISOString() // 1 hour ago
  };

  it('renders post content correctly', () => {
    render(<PostCard post={mockPost} />);

    expect(screen.getByText('John Doe')).toBeInTheDocument();
    expect(screen.getByText('Hello, world!')).toBeInTheDocument();
    expect(screen.getByText('42 likes')).toBeInTheDocument();
    expect(screen.getByText('1 hour ago')).toBeInTheDocument();
  });

  it('shows liked state correctly', () => {
    const likedPost = { ...mockPost, liked: true };
    render(<PostCard post={likedPost} />);

    const likeButton = screen.getByRole('button', { name: /unlike/i });
    expect(likeButton).toHaveAttribute('aria-pressed', 'true');
  });

  it('calls onLike when like button clicked', async () => {
    const onLike = jest.fn();
    render(<PostCard post={mockPost} onLike={onLike} />);

    await userEvent.click(screen.getByRole('button', { name: /like this post/i }));

    expect(onLike).toHaveBeenCalledWith('post-1');
  });

  it('handles double tap to like', async () => {
    const onLike = jest.fn();
    render(<PostCard post={mockPost} onLike={onLike} />);

    const postContent = screen.getByRole('article');

    // Simulate double tap
    fireEvent.click(postContent);
    fireEvent.click(postContent);

    expect(onLike).toHaveBeenCalledWith('post-1');
  });

  it('formats relative time correctly', () => {
    const posts = [
      { ...mockPost, createdAt: new Date(Date.now() - 60000).toISOString() }, // 1 min
      { ...mockPost, createdAt: new Date(Date.now() - 86400000).toISOString() } // 1 day
    ];

    const { rerender } = render(<PostCard post={posts[0]} />);
    expect(screen.getByText('1 minute ago')).toBeInTheDocument();

    rerender(<PostCard post={posts[1]} />);
    expect(screen.getByText('yesterday')).toBeInTheDocument();
  });

  it('renders media with alt text', () => {
    const postWithImage = {
      ...mockPost,
      media: [{
        type: 'image',
        url: 'https://example.com/image.jpg',
        altText: 'Beautiful sunset'
      }]
    };

    render(<PostCard post={postWithImage} />);

    const image = screen.getByRole('img', { name: 'Beautiful sunset' });
    expect(image).toHaveAttribute('src', 'https://example.com/image.jpg');
  });

  it('escapes XSS in post content', () => {
    const xssPost = {
      ...mockPost,
      content: '<script>alert("xss")</script>'
    };

    render(<PostCard post={xssPost} />);

    expect(screen.getByText('<script>alert("xss")</script>')).toBeInTheDocument();
    expect(document.querySelector('script')).not.toBeInTheDocument();
  });
});

// __tests__/utils/formatCount.test.js
describe('formatCount', () => {
  it('formats small numbers as-is', () => {
    expect(formatCount(0)).toBe('0');
    expect(formatCount(999)).toBe('999');
  });

  it('formats thousands with K', () => {
    expect(formatCount(1000)).toBe('1K');
    expect(formatCount(1500)).toBe('1.5K');
    expect(formatCount(999999)).toBe('999.9K');
  });

  it('formats millions with M', () => {
    expect(formatCount(1000000)).toBe('1M');
    expect(formatCount(2500000)).toBe('2.5M');
  });
});
```

### Integration Tests

```jsx
// __tests__/integration/feed.test.jsx
import { renderHook, act, waitFor } from '@testing-library/react';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { rest } from 'msw';
import { setupServer } from 'msw/node';
import { useFeed, useLikeMutation } from '../hooks/useFeed';

const mockPosts = [
  { id: 'post-1', content: 'First post', likeCount: 10, liked: false },
  { id: 'post-2', content: 'Second post', likeCount: 20, liked: true }
];

const server = setupServer(
  rest.get('/api/v1/feed', (req, res, ctx) => {
    const cursor = req.url.searchParams.get('cursor');
    return res(ctx.json({
      posts: cursor ? mockPosts.slice(1) : mockPosts,
      pagination: { next_cursor: cursor ? null : 'cursor-1', has_more: !cursor }
    }));
  }),

  rest.post('/api/v1/posts/:id/reactions', (req, res, ctx) => {
    return res(ctx.json({ success: true }));
  })
);

beforeAll(() => server.listen());
afterEach(() => server.resetHandlers());
afterAll(() => server.close());

describe('Feed Integration', () => {
  const createWrapper = () => {
    const queryClient = new QueryClient({
      defaultOptions: { queries: { retry: false } }
    });
    return ({ children }) => (
      <QueryClientProvider client={queryClient}>
        {children}
      </QueryClientProvider>
    );
  };

  it('fetches feed on mount', async () => {
    const { result } = renderHook(() => useFeed(), {
      wrapper: createWrapper()
    });

    await waitFor(() => {
      expect(result.current.isSuccess).toBe(true);
    });

    expect(result.current.data.pages[0].posts).toHaveLength(2);
  });

  it('loads more posts on fetchNextPage', async () => {
    const { result } = renderHook(() => useFeed(), {
      wrapper: createWrapper()
    });

    await waitFor(() => result.current.isSuccess);

    act(() => {
      result.current.fetchNextPage();
    });

    await waitFor(() => {
      expect(result.current.data.pages).toHaveLength(2);
    });
  });

  it('performs optimistic like update', async () => {
    const queryClient = new QueryClient();
    const wrapper = ({ children }) => (
      <QueryClientProvider client={queryClient}>
        {children}
      </QueryClientProvider>
    );

    const { result: feedResult } = renderHook(() => useFeed(), { wrapper });
    const { result: likeResult } = renderHook(() => useLikeMutation(), { wrapper });

    await waitFor(() => feedResult.current.isSuccess);

    // Trigger like
    act(() => {
      likeResult.current.mutate('post-1');
    });

    // Check optimistic update happened immediately
    const posts = queryClient.getQueryData(['feed']);
    const post = posts.pages[0].posts.find(p => p.id === 'post-1');
    expect(post.liked).toBe(true);
    expect(post.likeCount).toBe(11);
  });

  it('rolls back on like error', async () => {
    server.use(
      rest.post('/api/v1/posts/:id/reactions', (req, res, ctx) => {
        return res(ctx.status(500));
      })
    );

    const queryClient = new QueryClient();
    const wrapper = ({ children }) => (
      <QueryClientProvider client={queryClient}>
        {children}
      </QueryClientProvider>
    );

    const { result: feedResult } = renderHook(() => useFeed(), { wrapper });
    const { result: likeResult } = renderHook(() => useLikeMutation(), { wrapper });

    await waitFor(() => feedResult.current.isSuccess);

    const originalPost = feedResult.current.data.pages[0].posts.find(
      p => p.id === 'post-1'
    );

    act(() => {
      likeResult.current.mutate('post-1');
    });

    await waitFor(() => likeResult.current.isError);

    // Should be rolled back
    const posts = queryClient.getQueryData(['feed']);
    const post = posts.pages[0].posts.find(p => p.id === 'post-1');
    expect(post.liked).toBe(originalPost.liked);
    expect(post.likeCount).toBe(originalPost.likeCount);
  });
});
```

### E2E Tests

```jsx
// e2e/feed.spec.ts (Playwright)
import { test, expect } from '@playwright/test';

test.describe('News Feed', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('/');
    await page.waitForSelector('[data-testid="feed"]');
  });

  test('displays feed posts', async ({ page }) => {
    const posts = page.locator('[data-testid="post"]');
    await expect(posts.first()).toBeVisible();
    expect(await posts.count()).toBeGreaterThan(0);
  });

  test('infinite scroll loads more posts', async ({ page }) => {
    const initialCount = await page.locator('[data-testid="post"]').count();

    // Scroll to bottom
    await page.evaluate(() => window.scrollTo(0, document.body.scrollHeight));

    // Wait for loading
    await page.waitForSelector('[data-testid="loading-more"]');
    await page.waitForSelector('[data-testid="loading-more"]', { state: 'hidden' });

    const newCount = await page.locator('[data-testid="post"]').count();
    expect(newCount).toBeGreaterThan(initialCount);
  });

  test('like button toggles', async ({ page }) => {
    const firstPost = page.locator('[data-testid="post"]').first();
    const likeButton = firstPost.locator('[data-testid="like-button"]');
    const likeCount = firstPost.locator('[data-testid="like-count"]');

    const initialCount = await likeCount.textContent();

    // Like
    await likeButton.click();
    await expect(likeButton).toHaveAttribute('aria-pressed', 'true');

    // Unlike
    await likeButton.click();
    await expect(likeButton).toHaveAttribute('aria-pressed', 'false');
    await expect(likeCount).toHaveText(initialCount);
  });

  test('double tap to like on mobile', async ({ page }) => {
    // Set mobile viewport
    await page.setViewportSize({ width: 375, height: 667 });

    const firstPost = page.locator('[data-testid="post"]').first();
    const postMedia = firstPost.locator('[data-testid="post-media"]');

    // Double tap
    await postMedia.dblclick();

    // Heart animation should appear
    await expect(firstPost.locator('[data-testid="like-animation"]')).toBeVisible();

    // Like should be registered
    const likeButton = firstPost.locator('[data-testid="like-button"]');
    await expect(likeButton).toHaveAttribute('aria-pressed', 'true');
  });

  test('creates new post', async ({ page }) => {
    // Open composer
    await page.click('[data-testid="create-post-button"]');
    await expect(page.locator('[data-testid="post-composer"]')).toBeVisible();

    // Type content
    await page.fill('[data-testid="post-input"]', 'E2E test post content');

    // Submit
    await page.click('[data-testid="submit-post"]');

    // Should appear in feed
    await expect(page.locator('[data-testid="post"]').first())
      .toContainText('E2E test post content');
  });

  test('shows new posts indicator', async ({ page }) => {
    // Simulate new posts via WebSocket/SSE
    await page.evaluate(() => {
      window.dispatchEvent(new CustomEvent('new-posts', {
        detail: { count: 3 }
      }));
    });

    const indicator = page.locator('[data-testid="new-posts-indicator"]');
    await expect(indicator).toBeVisible();
    await expect(indicator).toContainText('3 new posts');

    // Click to load
    await indicator.click();
    await expect(indicator).not.toBeVisible();
  });

  test('keyboard navigation works', async ({ page }) => {
    // Focus first post
    await page.keyboard.press('Tab');
    await page.keyboard.press('Tab');

    const firstPost = page.locator('[data-testid="post"]').first();
    await expect(firstPost).toBeFocused();

    // Navigate to next
    await page.keyboard.press('j');
    const secondPost = page.locator('[data-testid="post"]').nth(1);
    await expect(secondPost).toBeFocused();

    // Like with keyboard
    await page.keyboard.press('l');
    const likeButton = secondPost.locator('[data-testid="like-button"]');
    await expect(likeButton).toHaveAttribute('aria-pressed', 'true');
  });
});
```

---

## 16. Offline Support & PWA

### Service Worker Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OFFLINE FEED ARCHITECTURE                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Caching Strategies:                                                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                         â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ASSET TYPE          â”‚  STRATEGY              â”‚  TTL                â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  App Shell           â”‚  Cache First           â”‚  Versioned          â”‚   â”‚
â”‚  â”‚  (HTML, JS, CSS)     â”‚  (pre-cached)          â”‚                     â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  Feed Data           â”‚  Network First         â”‚  1 hour             â”‚   â”‚
â”‚  â”‚  (API responses)     â”‚  (stale fallback)      â”‚                     â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  User Avatars        â”‚  Stale While           â”‚  24 hours           â”‚   â”‚
â”‚  â”‚                      â”‚  Revalidate            â”‚                     â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  Post Media          â”‚  Cache First           â”‚  7 days             â”‚   â”‚
â”‚  â”‚  (images, videos)    â”‚                        â”‚  LRU eviction       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  Offline Capabilities:                                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                       â”‚
â”‚  READ:                                                                      â”‚
â”‚  â€¢ View cached feed posts                                                   â”‚
â”‚  â€¢ View cached post details                                                 â”‚
â”‚  â€¢ View cached comments                                                     â”‚
â”‚                                                                              â”‚
â”‚  WRITE (Queued):                                                            â”‚
â”‚  â€¢ Create post (queued for sync)                                           â”‚
â”‚  â€¢ Like/unlike (queued for sync)                                           â”‚
â”‚  â€¢ Comment (queued for sync)                                               â”‚
â”‚                                                                              â”‚
â”‚  Sync Strategy:                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                              â”‚
â”‚  â€¢ Background Sync API when available                                      â”‚
â”‚  â€¢ Fallback: Sync on app open                                              â”‚
â”‚  â€¢ Conflict resolution: Server wins (with merge)                           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Service Worker Implementation

```javascript
// service-worker.js
import { precacheAndRoute } from 'workbox-precaching';
import { registerRoute } from 'workbox-routing';
import {
  NetworkFirst,
  CacheFirst,
  StaleWhileRevalidate
} from 'workbox-strategies';
import { ExpirationPlugin } from 'workbox-expiration';
import { BackgroundSyncPlugin } from 'workbox-background-sync';

// Precache app shell
precacheAndRoute(self.__WB_MANIFEST);

// Feed API: Network first with cache fallback
registerRoute(
  ({ url }) => url.pathname.startsWith('/api/v1/feed'),
  new NetworkFirst({
    cacheName: 'feed-cache',
    plugins: [
      new ExpirationPlugin({
        maxEntries: 50,
        maxAgeSeconds: 60 * 60 // 1 hour
      })
    ],
    networkTimeoutSeconds: 5
  })
);

// Post media: Cache first (content-addressed)
registerRoute(
  ({ url }) => url.hostname === 'media.feed.app',
  new CacheFirst({
    cacheName: 'media-cache',
    plugins: [
      new ExpirationPlugin({
        maxEntries: 200,
        maxAgeSeconds: 7 * 24 * 60 * 60, // 7 days
        purgeOnQuotaError: true
      })
    ]
  })
);

// Avatars: Stale while revalidate
registerRoute(
  ({ url }) => url.pathname.includes('/avatars/'),
  new StaleWhileRevalidate({
    cacheName: 'avatar-cache',
    plugins: [
      new ExpirationPlugin({
        maxEntries: 100,
        maxAgeSeconds: 24 * 60 * 60 // 24 hours
      })
    ]
  })
);

// Background sync for mutations
const postQueue = new BackgroundSyncPlugin('post-queue', {
  maxRetentionTime: 24 * 60 // 24 hours
});

const engagementQueue = new BackgroundSyncPlugin('engagement-queue', {
  maxRetentionTime: 24 * 60
});

// POST /posts - queue if offline
registerRoute(
  ({ url, request }) =>
    url.pathname === '/api/v1/posts' && request.method === 'POST',
  new NetworkOnly({ plugins: [postQueue] }),
  'POST'
);

// POST /reactions - queue if offline
registerRoute(
  ({ url, request }) =>
    url.pathname.includes('/reactions') && request.method === 'POST',
  new NetworkOnly({ plugins: [engagementQueue] }),
  'POST'
);
```

### IndexedDB Schema

```javascript
// db/FeedDatabase.js
import Dexie from 'dexie';

class FeedDatabase extends Dexie {
  constructor() {
    super('FeedApp');

    this.version(1).stores({
      // Cached posts
      posts: `
        id,
        authorId,
        createdAt,
        *hashtags
      `,

      // Cached feed order
      feed: `
        ++id,
        postId,
        position,
        addedAt
      `,

      // Pending actions (offline queue)
      pendingActions: `
        ++id,
        type,
        payload,
        createdAt,
        retries
      `,

      // User preferences
      preferences: `
        key
      `
    });
  }

  // Store feed posts
  async cacheFeed(posts) {
    await this.transaction('rw', [this.posts, this.feed], async () => {
      for (let i = 0; i < posts.length; i++) {
        await this.posts.put(posts[i]);
        await this.feed.put({
          postId: posts[i].id,
          position: i,
          addedAt: Date.now()
        });
      }
    });
  }

  // Get cached feed
  async getCachedFeed(limit = 50) {
    const feedItems = await this.feed
      .orderBy('position')
      .limit(limit)
      .toArray();

    const postIds = feedItems.map(f => f.postId);
    const posts = await this.posts.bulkGet(postIds);

    return posts.filter(Boolean);
  }

  // Queue action for sync
  async queueAction(type, payload) {
    await this.pendingActions.add({
      type, // 'create_post', 'like', 'unlike', 'comment'
      payload,
      createdAt: Date.now(),
      retries: 0
    });
  }

  // Get pending actions
  async getPendingActions() {
    return this.pendingActions.orderBy('createdAt').toArray();
  }

  // Remove synced action
  async removePendingAction(id) {
    await this.pendingActions.delete(id);
  }
}

export const db = new FeedDatabase();
```

---

## 17. Stories & Reels Deep Dive

### Stories Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STORIES COMPONENT ARCHITECTURE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Horizontal Carousel (Top of Feed):                                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”             â”‚ â”‚
â”‚  â”‚ â”‚ + â”‚ â”‚  â—‹  â”‚ â”‚  â—‹  â”‚ â”‚  â—‹  â”‚ â”‚  â—‹  â”‚ â”‚  â—‹  â”‚ â”‚  â—‹  â”‚ â”€â”€â”€â”€â”€â”€â”€>    â”‚ â”‚
â”‚  â”‚ â”‚Yourâ”‚ â”‚     â”‚ â”‚     â”‚ â”‚     â”‚ â”‚     â”‚ â”‚     â”‚ â”‚     â”‚             â”‚ â”‚
â”‚  â”‚ â”‚Storyâ”‚ â”‚John â”‚ â”‚Sarahâ”‚ â”‚Mike â”‚ â”‚Emma â”‚ â”‚Alex â”‚ â”‚Lisa â”‚             â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜             â”‚ â”‚
â”‚  â”‚  New    Unseen  Unseen  Seen    Seen    Seen    Seen               â”‚ â”‚
â”‚  â”‚          (ring) (ring)  (gray)  (gray)  (gray)  (gray)              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  Full-Screen Story Viewer:                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚ â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â”‚   â”‚ â”‚
â”‚  â”‚ â”‚ Story 1/3                                Progress bar           â”‚   â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚ â”‚ [Avatar] John Doe                                    â‹®   X     â”‚   â”‚ â”‚
â”‚  â”‚ â”‚          2h ago                                               â”‚   â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚                      [ STORY CONTENT ]                               â”‚ â”‚
â”‚  â”‚                      (Image or Video)                                 â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚         â—€ PREV                               NEXT â–¶                  â”‚ â”‚
â”‚  â”‚      (Tap left)                           (Tap right)                â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚ â”‚ [Reply input...]                              â¤ï¸  âœˆï¸           â”‚   â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  Interactions:                                                              â”‚
â”‚  â€¢ Tap left â†’ Previous story                                               â”‚
â”‚  â€¢ Tap right â†’ Next story                                                  â”‚
â”‚  â€¢ Tap and hold â†’ Pause                                                    â”‚
â”‚  â€¢ Swipe left â†’ Next user's stories                                        â”‚
â”‚  â€¢ Swipe right â†’ Previous user's stories                                   â”‚
â”‚  â€¢ Swipe down â†’ Close                                                       â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Stories Implementation

```jsx
// components/StoryViewer.jsx
const StoryViewer = ({ stories, initialIndex = 0, onClose }) => {
  const [currentUserIndex, setCurrentUserIndex] = useState(initialIndex);
  const [currentStoryIndex, setCurrentStoryIndex] = useState(0);
  const [isPaused, setIsPaused] = useState(false);
  const [progress, setProgress] = useState(0);

  const currentUser = stories[currentUserIndex];
  const currentStory = currentUser?.stories[currentStoryIndex];
  const STORY_DURATION = currentStory?.type === 'video'
    ? currentStory.duration * 1000
    : 5000; // 5 seconds for images

  // Progress timer
  useEffect(() => {
    if (isPaused || !currentStory) return;

    const interval = setInterval(() => {
      setProgress(prev => {
        if (prev >= 100) {
          goToNextStory();
          return 0;
        }
        return prev + (100 / (STORY_DURATION / 100));
      });
    }, 100);

    return () => clearInterval(interval);
  }, [isPaused, currentStory, STORY_DURATION]);

  // Mark as viewed
  useEffect(() => {
    if (currentStory && !currentStory.viewed) {
      markStoryViewed(currentStory.id);
    }
  }, [currentStory]);

  const goToNextStory = () => {
    if (currentStoryIndex < currentUser.stories.length - 1) {
      // Next story from same user
      setCurrentStoryIndex(prev => prev + 1);
      setProgress(0);
    } else if (currentUserIndex < stories.length - 1) {
      // Next user's stories
      setCurrentUserIndex(prev => prev + 1);
      setCurrentStoryIndex(0);
      setProgress(0);
    } else {
      // End of all stories
      onClose();
    }
  };

  const goToPrevStory = () => {
    if (currentStoryIndex > 0) {
      setCurrentStoryIndex(prev => prev - 1);
      setProgress(0);
    } else if (currentUserIndex > 0) {
      setCurrentUserIndex(prev => prev - 1);
      const prevUser = stories[currentUserIndex - 1];
      setCurrentStoryIndex(prevUser.stories.length - 1);
      setProgress(0);
    }
  };

  // Touch/click handlers
  const handleTap = (e) => {
    const rect = e.currentTarget.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const isRightSide = x > rect.width / 2;

    if (isRightSide) {
      goToNextStory();
    } else {
      goToPrevStory();
    }
  };

  // Swipe handlers
  const bind = useDrag(({ direction: [dx, dy], velocity, last }) => {
    if (!last) return;

    if (Math.abs(dy) > Math.abs(dx) && dy > 0 && velocity > 0.5) {
      // Swipe down - close
      onClose();
    } else if (dx < 0 && velocity > 0.5) {
      // Swipe left - next user
      if (currentUserIndex < stories.length - 1) {
        setCurrentUserIndex(prev => prev + 1);
        setCurrentStoryIndex(0);
        setProgress(0);
      }
    } else if (dx > 0 && velocity > 0.5) {
      // Swipe right - prev user
      if (currentUserIndex > 0) {
        setCurrentUserIndex(prev => prev - 1);
        setCurrentStoryIndex(0);
        setProgress(0);
      }
    }
  });

  return (
    <div
      className="story-viewer"
      {...bind()}
      onClick={handleTap}
      onMouseDown={() => setIsPaused(true)}
      onMouseUp={() => setIsPaused(false)}
      onTouchStart={() => setIsPaused(true)}
      onTouchEnd={() => setIsPaused(false)}
    >
      {/* Progress bars */}
      <div className="story-progress-container">
        {currentUser.stories.map((story, idx) => (
          <div key={story.id} className="story-progress-bar">
            <div
              className="story-progress-fill"
              style={{
                width: idx < currentStoryIndex ? '100%'
                     : idx === currentStoryIndex ? `${progress}%`
                     : '0%'
              }}
            />
          </div>
        ))}
      </div>

      {/* Header */}
      <div className="story-header">
        <img src={currentUser.avatar} alt="" />
        <div>
          <span>{currentUser.name}</span>
          <span>{formatTimeAgo(currentStory.createdAt)}</span>
        </div>
        <button onClick={onClose} aria-label="Close stories">
          <CloseIcon />
        </button>
      </div>

      {/* Content */}
      <div className="story-content">
        {currentStory.type === 'image' ? (
          <img src={currentStory.url} alt={currentStory.altText || ''} />
        ) : (
          <video
            src={currentStory.url}
            autoPlay
            muted
            playsInline
            onPause={() => setIsPaused(true)}
            onPlay={() => setIsPaused(false)}
          />
        )}
      </div>

      {/* Reply input */}
      <div className="story-reply">
        <input
          type="text"
          placeholder={`Reply to ${currentUser.name}...`}
          onClick={(e) => e.stopPropagation()}
        />
        <button aria-label="React with heart">â¤ï¸</button>
        <button aria-label="Share">âœˆï¸</button>
      </div>
    </div>
  );
};
```

### Reels Implementation

```jsx
// components/ReelsViewer.jsx
const ReelsViewer = ({ reels, onClose }) => {
  const [currentIndex, setCurrentIndex] = useState(0);
  const containerRef = useRef(null);
  const videoRefs = useRef({});

  // Snap scrolling
  useEffect(() => {
    const container = containerRef.current;
    if (!container) return;

    const handleScroll = () => {
      const scrollTop = container.scrollTop;
      const itemHeight = container.clientHeight;
      const newIndex = Math.round(scrollTop / itemHeight);

      if (newIndex !== currentIndex) {
        // Pause old video
        videoRefs.current[currentIndex]?.pause();
        // Play new video
        videoRefs.current[newIndex]?.play();
        setCurrentIndex(newIndex);
      }
    };

    container.addEventListener('scroll', handleScroll);
    return () => container.removeEventListener('scroll', handleScroll);
  }, [currentIndex]);

  // Intersection Observer for lazy loading
  useEffect(() => {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach(entry => {
          const video = entry.target;
          if (entry.isIntersecting) {
            video.play();
          } else {
            video.pause();
          }
        });
      },
      { threshold: 0.5 }
    );

    Object.values(videoRefs.current).forEach(video => {
      if (video) observer.observe(video);
    });

    return () => observer.disconnect();
  }, [reels]);

  return (
    <div
      ref={containerRef}
      className="reels-container"
      style={{
        scrollSnapType: 'y mandatory',
        overflowY: 'scroll',
        height: '100vh'
      }}
    >
      {reels.map((reel, index) => (
        <div
          key={reel.id}
          className="reel-item"
          style={{
            scrollSnapAlign: 'start',
            height: '100vh'
          }}
        >
          <video
            ref={el => videoRefs.current[index] = el}
            src={reel.videoUrl}
            loop
            muted
            playsInline
            poster={reel.thumbnail}
          />

          {/* Overlay controls */}
          <div className="reel-overlay">
            <div className="reel-author">
              <img src={reel.author.avatar} alt="" />
              <span>{reel.author.name}</span>
              <button>Follow</button>
            </div>

            <p className="reel-caption">{reel.caption}</p>

            <div className="reel-actions">
              <button aria-label="Like">
                <HeartIcon />
                <span>{formatCount(reel.likeCount)}</span>
              </button>
              <button aria-label="Comment">
                <CommentIcon />
                <span>{formatCount(reel.commentCount)}</span>
              </button>
              <button aria-label="Share">
                <ShareIcon />
              </button>
            </div>

            <div className="reel-audio">
              <AudioIcon />
              <marquee>{reel.audioName}</marquee>
            </div>
          </div>
        </div>
      ))}
    </div>
  );
};
```

---

## 18. Internationalization (i18n)

### Number & Date Formatting

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INTERNATIONALIZATION                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Number Formatting (Engagement Counts):                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                      â”‚
â”‚                                                                              â”‚
â”‚  Locale    â”‚  1000    â”‚  1500000    â”‚  Format                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  en-US     â”‚  1K      â”‚  1.5M       â”‚  Abbreviated                         â”‚
â”‚  de-DE     â”‚  1.000   â”‚  1,5 Mio.   â”‚  Period as thousands separator      â”‚
â”‚  ja-JP     â”‚  1000    â”‚  150ä¸‡      â”‚  Native numerals                    â”‚
â”‚  ar-SA     â”‚  Ù¡Ù¬Ù Ù Ù   â”‚  Ù¡Ù«Ù¥ Ù…Ù„ÙŠÙˆÙ† â”‚  Arabic numerals                    â”‚
â”‚                                                                              â”‚
â”‚  Implementation:                                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                             â”‚
â”‚  const formatCount = (count, locale) => {                                  â”‚
â”‚    if (count < 1000) {                                                     â”‚
â”‚      return count.toString();                                              â”‚
â”‚    }                                                                        â”‚
â”‚                                                                              â”‚
â”‚    // Use Intl.NumberFormat with compact notation                          â”‚
â”‚    return new Intl.NumberFormat(locale, {                                  â”‚
â”‚      notation: 'compact',                                                   â”‚
â”‚      compactDisplay: 'short'                                               â”‚
â”‚    }).format(count);                                                        â”‚
â”‚  };                                                                          â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  Relative Time Formatting:                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                   â”‚
â”‚                                                                              â”‚
â”‚  Locale    â”‚  1 hour ago    â”‚  Yesterday    â”‚  2 weeks ago                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  en-US     â”‚  1 hour ago    â”‚  yesterday    â”‚  2 weeks ago               â”‚
â”‚  es-ES     â”‚  hace 1 hora   â”‚  ayer         â”‚  hace 2 semanas            â”‚
â”‚  zh-CN     â”‚  1å°æ—¶å‰       â”‚  æ˜¨å¤©         â”‚  2å‘¨å‰                      â”‚
â”‚  ar-SA     â”‚  Ù…Ù†Ø° Ø³Ø§Ø¹Ø©      â”‚  Ø£Ù…Ø³          â”‚  Ù…Ù†Ø° Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ†               â”‚
â”‚                                                                              â”‚
â”‚  Implementation:                                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                             â”‚
â”‚  const formatRelativeTime = (date, locale) => {                            â”‚
â”‚    const rtf = new Intl.RelativeTimeFormat(locale, { numeric: 'auto' });  â”‚
â”‚    const diff = Date.now() - new Date(date);                               â”‚
â”‚    const minutes = Math.floor(diff / 60000);                               â”‚
â”‚    const hours = Math.floor(diff / 3600000);                               â”‚
â”‚    const days = Math.floor(diff / 86400000);                               â”‚
â”‚                                                                              â”‚
â”‚    if (minutes < 1) return rtf.format(0, 'minute'); // "just now"         â”‚
â”‚    if (minutes < 60) return rtf.format(-minutes, 'minute');               â”‚
â”‚    if (hours < 24) return rtf.format(-hours, 'hour');                     â”‚
â”‚    if (days < 7) return rtf.format(-days, 'day');                         â”‚
â”‚    if (days < 30) return rtf.format(-Math.floor(days/7), 'week');         â”‚
â”‚    return new Intl.DateTimeFormat(locale).format(new Date(date));         â”‚
â”‚  };                                                                          â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### RTL Support

```jsx
// i18n/setup.js
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';

const resources = {
  en: {
    feed: {
      newPosts: '{{count}} new post',
      newPosts_plural: '{{count}} new posts',
      like: 'Like',
      liked: 'Liked',
      comment: 'Comment',
      share: 'Share',
      writeComment: 'Write a comment...',
      viewAllComments: 'View all {{count}} comments',
      noMorePosts: "You're all caught up!",
      pullToRefresh: 'Pull to refresh'
    }
  },
  ar: {
    feed: {
      newPosts: 'Ù…Ù†Ø´ÙˆØ± Ø¬Ø¯ÙŠØ¯ ÙˆØ§Ø­Ø¯',
      newPosts_plural: '{{count}} Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©',
      like: 'Ø¥Ø¹Ø¬Ø§Ø¨',
      liked: 'Ø£Ø¹Ø¬Ø¨Ù†ÙŠ',
      comment: 'ØªØ¹Ù„ÙŠÙ‚',
      share: 'Ù…Ø´Ø§Ø±ÙƒØ©',
      writeComment: 'Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚Ø§Ù‹...',
      viewAllComments: 'Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª ({{count}})',
      noMorePosts: 'Ù„Ù‚Ø¯ ÙˆØµÙ„Øª Ø¥Ù„Ù‰ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©!',
      pullToRefresh: 'Ø§Ø³Ø­Ø¨ Ù„Ù„ØªØ­Ø¯ÙŠØ«'
    }
  }
};

i18n.use(initReactI18next).init({
  resources,
  lng: navigator.language,
  fallbackLng: 'en',
  interpolation: { escapeValue: false }
});

// RTL detection
const rtlLanguages = ['ar', 'he', 'fa', 'ur'];
i18n.on('languageChanged', (lng) => {
  const isRTL = rtlLanguages.includes(lng.split('-')[0]);
  document.documentElement.dir = isRTL ? 'rtl' : 'ltr';
  document.documentElement.lang = lng;
});

export default i18n;
```

### RTL CSS

```css
/* RTL-aware styles using CSS logical properties */
.post {
  padding-inline-start: 16px;
  padding-inline-end: 16px;
}

.post__author-info {
  margin-inline-start: 12px;
}

.post__actions {
  /* Icons and text will flip automatically */
  display: flex;
  gap: 16px;
}

.post__action-icon {
  /* For icons that should flip (arrows, etc.) */
  transform: scaleX(var(--rtl-flip, 1));
}

[dir="rtl"] {
  --rtl-flip: -1;
}

/* Share/forward icon should NOT flip */
.share-icon {
  transform: none !important;
}

/* Numeric content should remain LTR */
.post__stats {
  direction: ltr;
  unicode-bidi: embed;
}
```

---

## 19. Analytics & Observability

### Frontend Analytics

```jsx
// analytics/FeedAnalytics.js
class FeedAnalytics {
  constructor() {
    this.sessionId = crypto.randomUUID();
    this.impressionObserver = this.createImpressionObserver();
  }

  // Track post impressions (50% visible for 1 second)
  createImpressionObserver() {
    const viewedPosts = new Set();
    const timers = new Map();

    return new IntersectionObserver(
      (entries) => {
        entries.forEach(entry => {
          const postId = entry.target.dataset.postId;

          if (entry.isIntersecting && entry.intersectionRatio >= 0.5) {
            // Start timer
            timers.set(postId, setTimeout(() => {
              if (!viewedPosts.has(postId)) {
                viewedPosts.add(postId);
                this.track('post_impression', { postId });
              }
            }, 1000));
          } else {
            // Cancel timer if scrolled away
            clearTimeout(timers.get(postId));
            timers.delete(postId);
          }
        });
      },
      { threshold: 0.5 }
    );
  }

  // Observe a post element
  observePost(element) {
    this.impressionObserver.observe(element);
  }

  unobservePost(element) {
    this.impressionObserver.unobserve(element);
  }

  // Track scroll depth
  trackScrollDepth() {
    let maxDepth = 0;

    const handleScroll = throttle(() => {
      const scrollPercent = Math.round(
        (window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100
      );

      if (scrollPercent > maxDepth) {
        maxDepth = scrollPercent;

        // Track milestones
        if ([25, 50, 75, 100].includes(maxDepth)) {
          this.track('scroll_depth', { depth: maxDepth });
        }
      }
    }, 100);

    window.addEventListener('scroll', handleScroll, { passive: true });
  }

  // Track engagement actions
  trackLike(postId, liked) {
    this.track('engagement', {
      action: liked ? 'like' : 'unlike',
      postId
    });
  }

  trackComment(postId, commentLength) {
    this.track('engagement', {
      action: 'comment',
      postId,
      commentLength
    });
  }

  trackShare(postId, destination) {
    this.track('engagement', {
      action: 'share',
      postId,
      destination // 'twitter', 'facebook', 'copy_link', etc.
    });
  }

  // Track feed performance
  trackFeedLoad(loadTime, postCount) {
    this.track('performance', {
      metric: 'feed_load',
      loadTime,
      postCount
    });
  }

  trackMediaLoad(mediaType, loadTime, size) {
    this.track('performance', {
      metric: 'media_load',
      mediaType,
      loadTime,
      size
    });
  }

  // Core tracking method
  track(event, properties = {}) {
    const payload = {
      event,
      properties: {
        ...properties,
        sessionId: this.sessionId,
        timestamp: Date.now(),
        url: window.location.href,
        viewport: {
          width: window.innerWidth,
          height: window.innerHeight
        }
      }
    };

    // Batch and send
    if (navigator.sendBeacon) {
      navigator.sendBeacon('/api/analytics', JSON.stringify(payload));
    } else {
      fetch('/api/analytics', {
        method: 'POST',
        body: JSON.stringify(payload),
        keepalive: true
      });
    }
  }
}

export const analytics = new FeedAnalytics();
```

### Performance Monitoring

```jsx
// hooks/usePerformanceTracking.js
const usePerformanceTracking = () => {
  useEffect(() => {
    // Track Core Web Vitals
    if ('web-vital' in window) return; // Already tracking

    // Largest Contentful Paint
    new PerformanceObserver((list) => {
      const entries = list.getEntries();
      const lcp = entries[entries.length - 1];
      analytics.track('web_vital', {
        metric: 'LCP',
        value: lcp.startTime,
        rating: lcp.startTime < 2500 ? 'good' : lcp.startTime < 4000 ? 'needs-improvement' : 'poor'
      });
    }).observe({ type: 'largest-contentful-paint', buffered: true });

    // First Input Delay
    new PerformanceObserver((list) => {
      list.getEntries().forEach(entry => {
        const fid = entry.processingStart - entry.startTime;
        analytics.track('web_vital', {
          metric: 'FID',
          value: fid,
          rating: fid < 100 ? 'good' : fid < 300 ? 'needs-improvement' : 'poor'
        });
      });
    }).observe({ type: 'first-input', buffered: true });

    // Cumulative Layout Shift
    let clsValue = 0;
    new PerformanceObserver((list) => {
      list.getEntries().forEach(entry => {
        if (!entry.hadRecentInput) {
          clsValue += entry.value;
        }
      });
    }).observe({ type: 'layout-shift', buffered: true });

    // Report CLS on page hide
    window.addEventListener('visibilitychange', () => {
      if (document.visibilityState === 'hidden') {
        analytics.track('web_vital', {
          metric: 'CLS',
          value: clsValue,
          rating: clsValue < 0.1 ? 'good' : clsValue < 0.25 ? 'needs-improvement' : 'poor'
        });
      }
    });

    window['web-vital'] = true;
  }, []);
};
```

---

## 20. Notification System

### Push Notification Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NOTIFICATION SYSTEM                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Notification Types:                                                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                         â”‚
â”‚                                                                              â”‚
â”‚  Type           â”‚  Trigger                 â”‚  Priority    â”‚  Grouping      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  Like           â”‚  Someone likes post      â”‚  Low         â”‚  By post       â”‚
â”‚  Comment        â”‚  Someone comments        â”‚  Medium      â”‚  By post       â”‚
â”‚  Mention        â”‚  Tagged in post/comment  â”‚  High        â”‚  None          â”‚
â”‚  Follow         â”‚  New follower            â”‚  Medium      â”‚  By time       â”‚
â”‚  Share          â”‚  Someone shares post     â”‚  Low         â”‚  By post       â”‚
â”‚  Live           â”‚  Friend goes live        â”‚  High        â”‚  None          â”‚
â”‚  Memory         â”‚  "On this day" memory    â”‚  Low         â”‚  None          â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  Grouping Examples:                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                          â”‚
â”‚                                                                              â”‚
â”‚  âŒ Without grouping:                                                       â”‚
â”‚  â€¢ "John liked your post"                                                  â”‚
â”‚  â€¢ "Sarah liked your post"                                                 â”‚
â”‚  â€¢ "Mike liked your post"                                                  â”‚
â”‚  â€¢ "Emma liked your post"                                                  â”‚
â”‚                                                                              â”‚
â”‚  âœ… With grouping:                                                          â”‚
â”‚  â€¢ "John, Sarah, Mike, and 12 others liked your post"                     â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  Delivery Channels:                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                          â”‚
â”‚  â€¢ Push (Web Push API / FCM)                                               â”‚
â”‚  â€¢ In-app (SSE/WebSocket)                                                  â”‚
â”‚  â€¢ Email (batched digest)                                                   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Push Notification Implementation

```jsx
// notifications/PushNotificationManager.js
class PushNotificationManager {
  async requestPermission() {
    const permission = await Notification.requestPermission();

    if (permission === 'granted') {
      await this.subscribeToPush();
    }

    return permission;
  }

  async subscribeToPush() {
    const registration = await navigator.serviceWorker.ready;

    const subscription = await registration.pushManager.subscribe({
      userVisibleOnly: true,
      applicationServerKey: this.urlBase64ToUint8Array(VAPID_PUBLIC_KEY)
    });

    // Send subscription to server
    await fetch('/api/push/subscribe', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(subscription)
    });

    return subscription;
  }

  // Show local notification with actions
  async showNotification(data) {
    const registration = await navigator.serviceWorker.ready;

    await registration.showNotification(data.title, {
      body: data.body,
      icon: data.icon || '/icons/notification-192.png',
      badge: '/icons/badge-72.png',
      image: data.image, // Large image preview
      tag: data.tag || data.id, // Group by tag
      renotify: true, // Vibrate even if replacing
      data: {
        url: data.url,
        postId: data.postId
      },
      actions: this.getActionsForType(data.type)
    });
  }

  getActionsForType(type) {
    switch (type) {
      case 'like':
      case 'comment':
        return [
          { action: 'view', title: 'View' },
          { action: 'dismiss', title: 'Dismiss' }
        ];
      case 'follow':
        return [
          { action: 'follow-back', title: 'Follow Back' },
          { action: 'view-profile', title: 'View Profile' }
        ];
      case 'mention':
        return [
          { action: 'reply', title: 'Reply' },
          { action: 'view', title: 'View' }
        ];
      default:
        return [];
    }
  }

  urlBase64ToUint8Array(base64String) {
    const padding = '='.repeat((4 - base64String.length % 4) % 4);
    const base64 = (base64String + padding)
      .replace(/-/g, '+')
      .replace(/_/g, '/');
    const rawData = atob(base64);
    return Uint8Array.from([...rawData].map(c => c.charCodeAt(0)));
  }
}

// Service Worker handler
self.addEventListener('push', (event) => {
  const data = event.data?.json();

  event.waitUntil(
    self.registration.showNotification(data.title, {
      body: data.body,
      icon: data.icon,
      badge: '/icons/badge.png',
      tag: data.tag,
      data: data
    })
  );
});

self.addEventListener('notificationclick', (event) => {
  event.notification.close();

  const { action } = event;
  const { url, postId } = event.notification.data;

  if (action === 'reply') {
    event.waitUntil(
      clients.openWindow(`${url}?focus=reply`)
    );
  } else if (action === 'follow-back') {
    event.waitUntil(
      fetch('/api/follow', {
        method: 'POST',
        body: JSON.stringify({ userId: event.notification.data.userId })
      })
    );
  } else {
    event.waitUntil(
      clients.openWindow(url || '/')
    );
  }
});
```

### In-App Notification Center

```jsx
// components/NotificationCenter.jsx
const NotificationCenter = () => {
  const [isOpen, setIsOpen] = useState(false);
  const { data: notifications, markAsRead } = useNotifications();

  const unreadCount = notifications?.filter(n => !n.read).length || 0;

  const groupedNotifications = useMemo(() => {
    if (!notifications) return {};

    // Group by date
    return notifications.reduce((groups, notif) => {
      const date = formatDateGroup(notif.createdAt);
      if (!groups[date]) groups[date] = [];
      groups[date].push(notif);
      return groups;
    }, {});
  }, [notifications]);

  return (
    <div className="notification-center">
      <button
        onClick={() => setIsOpen(!isOpen)}
        aria-label={`Notifications. ${unreadCount} unread`}
        aria-expanded={isOpen}
        aria-haspopup="true"
      >
        <BellIcon />
        {unreadCount > 0 && (
          <span className="notification-badge" aria-hidden="true">
            {unreadCount > 99 ? '99+' : unreadCount}
          </span>
        )}
      </button>

      {isOpen && (
        <div
          className="notification-dropdown"
          role="menu"
          aria-label="Notifications"
        >
          <header>
            <h2>Notifications</h2>
            <button onClick={() => markAsRead('all')}>
              Mark all as read
            </button>
          </header>

          <div className="notification-list">
            {Object.entries(groupedNotifications).map(([date, notifs]) => (
              <div key={date}>
                <h3 className="notification-date-header">{date}</h3>
                {notifs.map(notif => (
                  <NotificationItem
                    key={notif.id}
                    notification={notif}
                    onRead={() => markAsRead(notif.id)}
                  />
                ))}
              </div>
            ))}
          </div>
        </div>
      )}
    </div>
  );
};

const NotificationItem = ({ notification, onRead }) => {
  return (
    <a
      href={notification.url}
      className={`notification-item ${!notification.read ? 'unread' : ''}`}
      onClick={onRead}
      role="menuitem"
    >
      <img
        src={notification.actor.avatar}
        alt=""
        className="notification-avatar"
      />

      <div className="notification-content">
        <p>
          <strong>{notification.actor.name}</strong>
          {' '}{notification.message}
        </p>
        <time>{formatTimeAgo(notification.createdAt)}</time>
      </div>

      {notification.image && (
        <img
          src={notification.image}
          alt=""
          className="notification-preview"
        />
      )}

      {!notification.read && (
        <span className="unread-dot" aria-label="Unread" />
      )}
    </a>
  );
};
```

---

## 21. Ads Integration

### Ad Placement Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AD INTEGRATION IN FEED                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Placement Rules:                                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                            â”‚
â”‚  â€¢ First ad: After 3rd organic post                                        â”‚
â”‚  â€¢ Subsequent ads: Every 5-7 posts (randomized)                            â”‚
â”‚  â€¢ Max ads per session: 1 per 3 posts (33%)                                â”‚
â”‚  â€¢ Never show 2 ads consecutively                                          â”‚
â”‚  â€¢ Frequency cap: Same ad max 3x per day per user                         â”‚
â”‚                                                                              â”‚
â”‚  Feed Layout with Ads:                                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                       â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Post 1 (organic)                                                   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  Post 2 (organic)                                                   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  Post 3 (organic)                                                   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ“¢ Sponsored                                                â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                              â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ [Ad Creative - Image/Video/Carousel]                        â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                              â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ Brand Name                                    [Shop Now]    â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ Ad description text...                                      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                              â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ [â‹® Ad Preferences]                                          â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  Post 4 (organic)                                                   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  Post 5 (organic)                                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  Ad Types:                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                   â”‚
â”‚  â€¢ Image ad (single image)                                                 â”‚
â”‚  â€¢ Video ad (autoplay muted)                                               â”‚
â”‚  â€¢ Carousel ad (swipeable images)                                          â”‚
â”‚  â€¢ Story ad (full-screen in stories)                                       â”‚
â”‚  â€¢ Reel ad (full-screen video in reels)                                    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ad Component Implementation

```jsx
// components/SponsoredPost.jsx
const SponsoredPost = ({ ad, onImpression, onClick }) => {
  const adRef = useRef(null);
  const [hasTrackedImpression, setHasTrackedImpression] = useState(false);

  // Track impression when 50% visible for 1 second
  useEffect(() => {
    if (hasTrackedImpression) return;

    const observer = new IntersectionObserver(
      ([entry]) => {
        if (entry.isIntersecting && entry.intersectionRatio >= 0.5) {
          const timer = setTimeout(() => {
            onImpression(ad.id);
            setHasTrackedImpression(true);
          }, 1000);

          return () => clearTimeout(timer);
        }
      },
      { threshold: 0.5 }
    );

    if (adRef.current) {
      observer.observe(adRef.current);
    }

    return () => observer.disconnect();
  }, [ad.id, hasTrackedImpression, onImpression]);

  const handleClick = (e) => {
    onClick(ad.id, ad.clickUrl);
    // Track click before navigation
    analytics.track('ad_click', {
      adId: ad.id,
      campaignId: ad.campaignId,
      placement: 'feed'
    });
  };

  return (
    <article
      ref={adRef}
      className="post sponsored-post"
      data-ad-id={ad.id}
      aria-label="Sponsored post"
    >
      {/* Sponsored label */}
      <div className="sponsored-label">
        <span>Sponsored</span>
        <button
          onClick={(e) => {
            e.stopPropagation();
            showAdPreferences(ad.id);
          }}
          aria-label="Ad preferences"
        >
          <MoreIcon />
        </button>
      </div>

      {/* Advertiser info */}
      <header className="post__header">
        <img src={ad.advertiser.logo} alt="" />
        <div>
          <span className="advertiser-name">{ad.advertiser.name}</span>
          {ad.advertiser.verified && <VerifiedBadge />}
        </div>
      </header>

      {/* Ad creative */}
      <div className="post__content" onClick={handleClick}>
        {ad.type === 'image' && (
          <img
            src={ad.imageUrl}
            alt={ad.altText || `Ad from ${ad.advertiser.name}`}
            loading="lazy"
          />
        )}

        {ad.type === 'video' && (
          <video
            src={ad.videoUrl}
            poster={ad.thumbnailUrl}
            autoPlay
            muted
            loop
            playsInline
            aria-label={ad.altText || `Video ad from ${ad.advertiser.name}`}
          />
        )}

        {ad.type === 'carousel' && (
          <AdCarousel
            images={ad.images}
            onSlideChange={(index) => {
              analytics.track('ad_carousel_slide', {
                adId: ad.id,
                slideIndex: index
              });
            }}
          />
        )}
      </div>

      {/* Call to action */}
      <footer className="sponsored-footer">
        <div className="ad-text">
          <p className="ad-headline">{ad.headline}</p>
          <p className="ad-description">{ad.description}</p>
        </div>
        <a
          href={ad.clickUrl}
          onClick={handleClick}
          className="cta-button"
          target="_blank"
          rel="noopener sponsored"
        >
          {ad.ctaText}
        </a>
      </footer>

      {/* Why am I seeing this? */}
      <button
        className="ad-info-link"
        onClick={() => showAdExplanation(ad)}
      >
        Why am I seeing this ad?
      </button>
    </article>
  );
};
```

### Ad Preferences Modal

```jsx
// components/AdPreferencesModal.jsx
const AD_HIDE_REASONS = [
  { id: 'not-interested', label: 'Not interested in this ad' },
  { id: 'seen-too-often', label: 'I keep seeing this ad' },
  { id: 'inappropriate', label: 'Ad is inappropriate' },
  { id: 'misleading', label: 'Ad is misleading' },
  { id: 'not-relevant', label: 'Ad is not relevant to me' }
];

const AdPreferencesModal = ({ ad, isOpen, onClose }) => {
  const [selectedReason, setSelectedReason] = useState(null);

  const handleHideAd = async () => {
    await api.hideAd(ad.id, selectedReason);
    toast.success('You won\'t see this ad again');
    onClose();
  };

  const handleHideAdvertiser = async () => {
    await api.hideAdvertiser(ad.advertiser.id);
    toast.success(`You won't see ads from ${ad.advertiser.name}`);
    onClose();
  };

  return (
    <Modal isOpen={isOpen} onClose={onClose} aria-labelledby="ad-prefs-title">
      <h2 id="ad-prefs-title">Ad preferences</h2>

      <div className="ad-info">
        <img src={ad.advertiser.logo} alt="" />
        <span>{ad.advertiser.name}</span>
      </div>

      <section>
        <h3>Why am I seeing this ad?</h3>
        <ul className="ad-reasons">
          {ad.targetingReasons.map(reason => (
            <li key={reason}>{reason}</li>
          ))}
        </ul>
      </section>

      <section>
        <h3>Hide this ad</h3>
        <fieldset>
          {AD_HIDE_REASONS.map(reason => (
            <label key={reason.id}>
              <input
                type="radio"
                name="hideReason"
                value={reason.id}
                checked={selectedReason === reason.id}
                onChange={() => setSelectedReason(reason.id)}
              />
              {reason.label}
            </label>
          ))}
        </fieldset>
        <button
          onClick={handleHideAd}
          disabled={!selectedReason}
        >
          Hide this ad
        </button>
      </section>

      <section>
        <h3>More options</h3>
        <button onClick={handleHideAdvertiser}>
          Hide all ads from {ad.advertiser.name}
        </button>
        <a href="/settings/ad-preferences">
          Manage your ad preferences
        </a>
      </section>
    </Modal>
  );
};
```

---

## Quick Reference Cheat Sheet

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         QUICK REFERENCE                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Feed Generation:                                                           â”‚
â”‚  â€¢ Regular users â†’ Push (fan-out on write)                                 â”‚
â”‚  â€¢ Celebrities â†’ Pull (fan-in on read)                                     â”‚
â”‚  â€¢ Hybrid: Best of both                                                     â”‚
â”‚                                                                              â”‚
â”‚  Protocol Choice:                                                           â”‚
â”‚  â€¢ Feed CRUD â†’ REST                                                         â”‚
â”‚  â€¢ Real-time updates â†’ SSE (simpler) or WebSocket                          â”‚
â”‚  â€¢ NOT: Long polling (inefficient)                                          â”‚
â”‚                                                                              â”‚
â”‚  Database Choice:                                                           â”‚
â”‚  â€¢ Posts, Feed â†’ Cassandra (write scale)                                   â”‚
â”‚  â€¢ Users, Relationships â†’ PostgreSQL (ACID)                                â”‚
â”‚  â€¢ Cache â†’ Redis (ZSET for feed)                                           â”‚
â”‚  â€¢ Events â†’ Kafka                                                           â”‚
â”‚                                                                              â”‚
â”‚  Ranking:                                                                   â”‚
â”‚  â€¢ Score = Affinity Ã— PostWeight Ã— TimeDecay Ã— TypeBoost                  â”‚
â”‚  â€¢ Recalculate periodically, cache result                                  â”‚
â”‚                                                                              â”‚
â”‚  Performance:                                                               â”‚
â”‚  â€¢ Virtualize feed list                                                     â”‚
â”‚  â€¢ Lazy load media                                                          â”‚
â”‚  â€¢ Optimistic updates                                                       â”‚
â”‚  â€¢ Short cache TTL + real-time badge                                       â”‚
â”‚                                                                              â”‚
â”‚  State Management:                                                          â”‚
â”‚  â€¢ Server state â†’ React Query (infinite query)                             â”‚
â”‚  â€¢ Real-time â†’ Zustand (new posts count)                                   â”‚
â”‚  â€¢ Optimistic â†’ useMutation with rollback                                  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
